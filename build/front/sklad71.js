!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/codebase/",n(n.s=29)}([function(e,t,n){"use strict";function o(e){var t={genLabel:function(e){var t=document.app.states[e];return"<span class='table_icon "+t.picture+"', style='color: "+t.color+" '></span><span class='ordinary_label'>"+t.value.toLowerCase()+"</span>"},html_button_template:function(e,t,n){return"<div class='webix_el_button'><button class='webix_img_btn_abs', style='background:transparent'>"+("<div class='"+(n=n||"html_button")+"', title='"+t+"', style='background-image:url("+e+");'></div>")+"</button> </div>"},saveDocument:function(e){var t=e.$$("__charge")?{charge:e.$$("__charge").getValue()}:{},n={header:Object.assign(t,e.getHeader().getData()),table:e.$$("__table").serialize()},o=e.validateDocument(e,n);if(o)return o;var i=e.saveDocumentServer(e,n);return i||!1},holdDocument:function(e,t,n){var o={doc_type:e,doc_id:t,intable:n};return l(c({method:"hold_document",kwargs:{user:p(),filters:o}},!0).response,"s")},unDeleteDocument:function(e,t,n){var o={doc_type:e,doc_id:t,intable:n};return l(c({method:"undelete_document",kwargs:{user:p(),filters:o}},!0).response,"s")},deleteDocument:function(e,t,n){var o={doc_type:e,doc_id:t,intable:n};return l(c({method:"delete_document",kwargs:{user:p(),filters:o}},!0).response,"s")},unHoldDocument:function(e,t,n){var o={doc_type:e,doc_id:t,intable:n};return l(c({method:"unhold_document",kwargs:{user:p(),filters:o}},!0).response,"s")},logout:function(){h(e.config.sklad_cook),location.href=document.location.href},search_key:function(e,t){var n=Object.keys(e),o=void 0;return n.forEach((function(e){-1!==e.indexOf(t)&&(o=e)})),o}};e.setService("common",t)}function i(e){e.translates=l(c({method:"get_translates",kwargs:{user:"XXX"}},!0).response,"s").data,e.states=l(c({method:"get_states",kwargs:{user:"XXX"}},!0).response,"s").data}function r(e){var t=document.app,n=void 0;return t&&t.translates?n=t.translates[e]:(console.log("gg1",new Date),n="undefined"),n}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;webix.message({type:t,text:e,expire:1e3*n})}function s(e,t,n){console.log("loading error"),console.log(e),console.log(t),console.log(n),n.status}function c(e,t){var n="https://online365.pro/RPC/";return!0===t?webix.ajax().sync().headers({"Content-type":"application/json"}).post(n,e,{error:s}):webix.ajax().timeout(9e4).headers({"Content-type":"application/json"}).post(n,e,{error:s})}function l(e,t){var n,o={};return"s"===t?n=JSON.parse(e):"a"===t&&(n=e.json()),n&&n.result&&n.result[0]&&n.result[0].data&&(o=n.result[0]),o}function u(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):NaN}function d(e,t,n){var o=(n=n||{}).expires;if("number"==typeof o&&o){var i=new Date;i.setTime(i.getTime()+1e3*o),o=n.expires=i}o&&o.toUTCString&&(n.expires=o.toUTCString());var r=e+"="+(t=encodeURIComponent(t));for(var a in n){r+="; "+a;var s=n[a];!0!==s&&(r+="="+s)}document.cookie=r}function h(e){d(e,"",{expires:-1,path:"/"})}function p(){return $$("sklad_main_ui").$scope.app.config.user}function f(e,t){var n=e.config.suggest;if(n){var o=e.config.suggest=function(e){if("string"==typeof e)return e;if(e.linkInput)return e._settings.id;"object"==_typeof(e)?(isArray(e)&&(e={data:e}),e.view=e.view||"suggest"):!0===e&&(e={view:"suggest"});return ui(e).config.id}(n),i=$$(o);i&&t&&i.linkInput(t)}}n.r(t),n.d(t,"common",(function(){return o})),n.d(t,"getRefs",(function(){return i})),n.d(t,"names",(function(){return r})),n.d(t,"message",(function(){return a})),n.d(t,"request",(function(){return c})),n.d(t,"checkResponse",(function(){return l})),n.d(t,"getCookie",(function(){return u})),n.d(t,"setCookie",(function(){return d})),n.d(t,"deleteCookie",(function(){return h})),n.d(t,"getUser",(function(){return p})),n.d(t,"formatText",(function(){return _})),n.d(t,"extendWebix",(function(){return m}));var _={parse:function(e){return e},edit:function(e){return webix.Number.formatNumber(e)}};function m(){webix.editors.price=webix.extend({getValue:function(){return 100*parseFloat(this.getInputNode(this.node).value.toString().replace(",","."))},setValue:function(e){var t=this.getInputNode(this.node);t.value=e/100,f(this,t)}},webix.editors.text),webix.Number.formatNumber=function(e,t){if(!e&&0!==e)return"";if(t=t||{groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,prefix:"",sufix:" ₽"},""===(e/=100)||void 0===e)return e;var n=(e=parseFloat(e))<0?"-":"";e=Math.abs(e),t.decimalOptional||(e=e.toFixed(t.decimalSize));var o=e.toString();o=o.split(".");var i="";if(t.groupSize){var r=t.groupSize,a=o[0].length;do{i=((a-=r)>0?o[0].substr(a,r):o[0].substr(0,r+a))+(i?t.groupDelimiter+i:"")}while(a>0)}else i=o[0];return o=t.decimalSize?n+i+(o[1]?t.decimalDelimiter+o[1]:""):n+i,t.prefix||t.sufix?t.prefix+o+t.sufix:o},webix.ui.datafilter.totalTable=webix.extend({refresh:function(e,t,n){t.firstChild.innerHTML=isNaN(e.data.order.length)?0:e.data.order.length}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalTableLong=webix.extend({refresh:function(e,t,n){t.firstChild.innerHTML="Всего в выборке: ",t.firstChild.innerHTML+=isNaN(e.data.order.length)?0:e.data.order.length}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalVisibleColumn=webix.extend({refresh:function(e,t,n){var o=e.data.pull,i=0;for(var r in o){var a=+o[r][n.columnId];isNaN(a)||(i+=a)}t.firstChild.innerHTML=webix.Number.formatNumber(i)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,n){var o=0;e.mapCells(null,n.columnId,null,1,(function(e){var t=+e;return isNaN(t)||(o+=t),e})),t.firstChild.innerHTML=webix.Number.formatNumber(o)}},webix.ui.datafilter.summColumn),webix.protoUI({name:"cWindow",defaults:{resize:!1,modal:!1,move:!1,position:"center"},$init:function(e){webix.extend(e,{head:{view:"toolbar",cols:[{view:"label",label:""},{view:"button",type:"icon",icon:"mdi-close",height:26,width:26,on:{onItemClick:function(){this.getTopParentView().hide()}}}]}})}},webix.ui.window)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return $}));var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(){a(this,e)},c=function(){function e(t){a(this,e),this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,n){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),n))return this.show(null)},e.prototype.getParam=function(e,t){var n=this._data[e];if(void 0!==n||!t)return n;var o=this.getParentView();return o?o.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(n){return(n.config.id===e||n.config.localId===e)&&n.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,n){var o=e.attachEvent(t,n);return this._events.push({obj:e,id:o}),o},e.prototype.contains=function(e){for(var t in this._subs){var n=this._subs[t].view;if(n===e||n.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var n=t.view._getDefaultSub();if(n)return n}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function l(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),n=[],o=0;o<t.length;o++){var i=t[o],r={},a=i.indexOf(":");if(-1===a&&(a=i.indexOf("?")),-1!==a){var s=i.substr(a+1).split(/[\:\?\&]/g),c=Array.isArray(s),l=0;for(s=c?s:s[Symbol.iterator]();;){var u;if(c){if(l>=s.length)break;u=s[l++]}else{if((l=s.next()).done)break;u=l.value}var d=u.split("=");r[d[0]]=decodeURIComponent(d[1])}}n[o]={page:a>-1?i.substr(0,a):i,params:r,isNew:!0}}return n}function u(e){var t=[],n=e,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var r;if(o){if(i>=n.length)break;r=n[i++]}else{if((i=n.next()).done)break;r=i.value}var a=r;t.push("/"+a.page);var s=d(a.params);s&&t.push("?"+s)}return t.join("")}function d(e){var t=[];for(var n in e)t.length&&t.push("&"),t.push(n+"="+encodeURIComponent(e[n]));return t.join("")}var h=function(){function e(t,n){a(this,e),this._next=1,this.route="string"==typeof t?{url:l(t),path:t}:t,this.index=n}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(){return new e(this.route,this.index+this._next)},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=u(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var n=this.route.url;if(null===e)return n;var o=this.route.url;if(n=o.slice(0,this.index+(t?this._next:0)),e){n=n.concat(l(e));for(var i=0;i<n.length;i++)o[i]&&(n[i].view=o[i].view),o[i]&&n[i].page===o[i].page&&(n[i].isNew=!1)}return n},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=u(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,n){var o=this,i=this._join(e,n);return new Promise((function(e,n){var r=u(i),a={url:i,redirect:r,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[a.redirect,t,a]))return void n(new s);a.confirm.catch((function(e){return n(e)})).then((function(){if(null!==a.redirect){if(a.redirect!==r)return c.show(a.redirect),void n(new s);o.route.path=r,o.route.url=i,e()}else n(new s)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=u(t.url)),new e(t,0)},e.prototype.update=function(e,t,n){var o=this.route.url[this.index+(n||0)];if(!o)return this.route.url.push({page:"",params:{}}),this.update(e,t,n);""===e?o.page=t:o.params[e]=t,this.route.path=u(this.route.url)},e}(),p=function(e){function t(n,o){a(this,t);var r=i(this,e.call(this,n.webix));return r.app=n,r._children=[],r}return r(t,e),t.prototype.ui=function(e,t){var n=(t=t||{}).container||e.container,i=this.app.createView(e);return this._children.push(i),i.render(n,this._segment,this),"object"!==(void 0===e?"undefined":o(e))||e instanceof c?i:i.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"===(void 0===e?"undefined":o(e))){for(var n in e)this.setParam(n,e[n]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var i=this.getParentView();return i?i.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var r=this.getSubViewInfo(t.target);if(r){if(r.parent!==this)return r.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,r.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},t.prototype._show=function(e,t,n){var o=this;return e.show(t,n,!0).then((function(){return o._init_url_data(),o._urlChange()})).then((function(){e.route.linkRouter&&(o.app.getRouter().set(e.route.path,{silent:!0}),o.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,n){var o=this;"string"==typeof t&&(t=new h(t,0)),this._segment=t,this._parent=n,this._init_url_data();var i="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==i?(this._container=i,this._render(t)):this._urlChange().then((function(){return o.getRoot()}))},t.prototype._render=function(e){var t=this,n=this.config();return n.then?n.then((function(n){return t._render_final(n,e)})):this._render_final(n,e)},t.prototype._render_final=function(e,t){var n=this,o=null,i=null,r=!1;if(this._container.tagName?i=this._container:(o=this._container).popup?(i=document.body,r=!0):i=this.webix.$$(o.id),!this.app||!i)return Promise.reject(null);var a=void 0,s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!o&&s.isNew&&s.view&&s.view.destructor();try{if(o&&!r){var l=i,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,i);var d=this._root;r&&d.setPosition&&!d.isVisible()&&d.show(),o&&(o.view&&o.view!==this&&o.view!==this.app&&o.view.destructor(),o.id=this._root.config.id,this.getParentView()||!this.app.app?o.view=this:o.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),a=Promise.resolve(this._init(this._root,t)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,t.suburl())}))}))}catch(e){a=Promise.reject(e)}return a.catch((function(e){return n._initError(n,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var n in this._subs){var o=this._subs[n],i=this._renderFrameLock(n,o,null);i&&t.push(i)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,n){if(!t.lock){var o=this._renderFrame(e,t,n);o&&(t.lock=o.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,n){var o=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==n&&(t.url=n),t.route){if(null!==n)return t.route.show(n,t.view).then((function(){return o._createSubView(t,t.route)}));if(t.branch)return}var i=t.view;if(!i&&t.url){if("string"==typeof t.url)return t.route=new h(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||i instanceof t.url||(i=new t.url(this.app,"")),i||(i=t.url)}if(i)return i.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var n=this;return this.app.createFromURL(t.current()).then((function(o){return o.render(e,t,n)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(c),f=function(e){function t(n,o){a(this,t);var r=i(this,e.call(this,n,o));return r._ui=o.ui,r}return r(t,e),t.prototype.config=function(){return this._ui},t}(p),_=function(){function e(t,n,o){a(this,e),this.path="",this.app=o}return e.prototype.set=function(e,t){this.path=e;var n=this.app;n.app.getRouter().set(n._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),m=!0,b=function(e){function t(n){a(this,t);var o=(n||{}).webix||window.webix,r=i(this,e.call(this,o));return r.config=r.webix.extend({name:"App",version:"1.0",start:"/home"},n,!0),r.app=r.config.app,r.ready=Promise.resolve(),r._services={},r.webix.extend(r,r.webix.EventSystem),r}return r(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,n){if((e instanceof c||"function"==typeof e&&e.prototype instanceof c)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,n);for(var i in t=t||(e instanceof Array?[]:{}),e){var r=e[i];if("function"==typeof r&&r.prototype instanceof c&&(r={$subview:r}),!r||"object"!==(void 0===r?"undefined":o(r))||r instanceof this.webix.DataCollection||r instanceof RegExp)t[i]=r;else if(r instanceof Date)t[i]=new Date(r);else{var a=this.copyConfig(r,r instanceof Array?[]:{},n);null!==a&&(t[i]=a)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var n=t.getAttribute("trigger");if(n)return this._forView(t,(function(e){return e.app.trigger(n)})),e.cancelBubble=!0,e.preventDefault();var o=t.getAttribute("route");if(o)return this._forView(t,(function(e){return e.show(o)})),e.cancelBubble=!0,e.preventDefault()}var i=t.parentNode;i&&this.clickHandler(e,i)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,n=this.config.views,o=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{n&&"string"==typeof(o="function"==typeof n?n(e):n[e])&&(e=o,o=null),o||(o="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){o=this._loadError(e,t)}return o.then||(o=Promise.resolve(o)),o=o.then((function(e){return e.__esModule?e.default:e})).catch((function(n){return t._loadError(e,n)}))},t.prototype._forView=function(e,t){var n=this.webix.$$(e);n&&t(n.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},t.prototype.createView=function(e,n){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:n,router:_});if(e.prototype instanceof c)return new e(this,{name:n});e=e(this)}return e instanceof c?e:new f(this,{name:n,ui:e})},t.prototype.show=function(e){return this.render(this._container,e||this.config.start)},t.prototype.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.apply(e,n)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.apply(e,n)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var n=0;n<t.length;n++)if(console.error(t[n]),t[n]instanceof Error){var o=t[n].message;0===o.indexOf("Module build failed")?(o=o.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+o+"</pre>"):(o+="<br><br>Check console for more details",this.webix.message({type:"error",text:o,expire:-1}))}},t.prototype.render=function(e,t,n){var o=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var i=null;!this.$router?(m&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return o.clickHandler(e)})),m=!1),"string"==typeof t&&(t=new h(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):i="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var r=this.getSubView(),a=this._subSegment,s=a.show(i,r).then((function(){return o.createFromURL(a.current())})).then((function(t){return t.render(e,a)})).then((function(e){return o.$router.set(a.route.path,{silent:!0}),o.callEvent("app:route",[o.getUrl()]),e}));return this.ready=this.ready.then((function(){return s})),s},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new p(this,{})},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof s))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var n=this._container;this.webix.html.addCss(n,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(n,"webixappstart"),t.webix.html.addCss(n,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new h(this.config.start,0));else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),e=new h(o,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,n){var o=!0!==e.$subview?e.$subview:null,i=e.name||(o?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(n[i]={id:t.id,url:o,branch:e.branch,popup:e.popup}).popup?null:t},t}(c),w=function(){function e(t,n){var o=this;a(this,e),this.config=n||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return o.cb(o.get())}}return e.prototype.set=function(e,t){var n=this;if(this.config.routes){var o=e.split("?",2);for(var i in this.config.routes)if(this.config.routes[i]===o[0]){e=i+(o.length>1?"?"+o[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return n.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),n=this.config.routes[t[0]];n&&(e=n+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),g=!1;function v(e){if(!g&&e){g=!0;var t=window;t.Promise||(t.Promise=e.promise);var n=e.version.split(".");10*n[0]+1*n[1]<53&&(e.ui.freeze=function(t){var n=t();return n&&n.then?n.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),n});var i=e.ui.baselayout.prototype.addView,r=e.ui.baselayout.prototype.removeView,a={addView:function(e,t){var n=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return i.apply(this,arguments);var r=function(){var o=n.$scope,r={};e=o.app.copyConfig(e,{},r),i.apply(n,[e,t]);var a=function(e){o._renderFrame(e,r[e],null).then((function(){o._subs[e]=r[e]}))};for(var s in r)a(s);return{v:e.id}}();return"object"===(void 0===r?"undefined":o(r))?r.v:void 0},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var n in t){var o=t[n];e.$$(o.id)||(o.view.destructor(),delete t[n])}}}};e.extend(e.ui.layout.prototype,a,!0),e.extend(e.ui.baselayout.prototype,a,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var n=e.uid().toString();for(var o in t.body={id:n},this.$ready.push((function(){this.$app.render({id:n})})),this.$app){var i=this.$app[o];"function"!=typeof i||this[o]||(this[o]=i.bind(this.$app))}}},e.ui.proxy)}}var y=function(e){function t(n){a(this,t),n.router=n.router||w;var o=i(this,e.call(this,n));return v(o.webix),o}return r(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),n(31)("./"+e)},t}(b),$=(function(){function e(t,n,o){a(this,e),this.storage=n.storage||o.webix.storage.session,this.name=n.storeName||n.id+":route",this.cb=t}e.prototype.set=function(e,t){var n=this;this.storage.put(this.name,e),t&&t.silent||setTimeout((function(){return n.cb(e)}),1)},e.prototype.get=function(){return this.storage.get(this.name)}}(),function(e){function t(){return a(this,t),i(this,e.apply(this,arguments))}r(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(w),function(){function e(t,n){a(this,e),this.path="",this.cb=t}return e.prototype.set=function(e,t){var n=this;this.path=e,t&&t.silent||setTimeout((function(){return n.cb(e)}),1)},e.prototype.get=function(){return this.path},e}());function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function O(e,t,n){for(var o in e)x(e,o)&&t.call(n||e,e[o],o,e)}function k(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var j=String.prototype.replace,C=String.prototype.split,I=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},E={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:I,chinese:function(){return 0},croatian:I,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:I,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},S={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function P(e){var t,n=(t={},O(S,(function(e,n){O(e,(function(e){t[e]=n}))})),t);return n[e]||n[C.call(e,/-/,1)[0]]||n.en}function V(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var R=/\$/g,T=/%\{(.*?)\}/g;function W(e,t,n,o){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var i=e,r=o||T,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&i){var s=C.call(i,"||||");i=(s[function(e,t){return E[P(e)](t)}(n||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return i=j.call(i,r,(function(e,t){return x(a,t)&&null!=a[t]?j.call(a[t],R,"$$"):e}))}function N(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var n=t.allowMissing?W:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:n,this.warn=t.warn||k,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",n=e&&e.suffix||"}";if("||||"===t||"||||"===n)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(V(t)+"(.*?)"+V(n),"g")}(t.interpolation)}N.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},N.prototype.extend=function(e,t){O(e,(function(e,n){var i=t?t+"."+n:n;"object"===(void 0===e?"undefined":o(e))?this.extend(e,i):this.phrases[i]=e}),this)},N.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:O(e,(function(e,n){var i=t?t+"."+n:n;"object"===(void 0===e?"undefined":o(e))?this.unset(e,i):delete this.phrases[i]}),this)},N.prototype.clear=function(){this.phrases={}},N.prototype.replace=function(e){this.clear(),this.extend(e)},N.prototype.t=function(e,t){var n,o,i=null==t?{}:t;if("string"==typeof this.phrases[e])n=this.phrases[e];else if("string"==typeof i._)n=i._;else if(this.onMissingKey){o=(0,this.onMissingKey)(e,i,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),o=e;return"string"==typeof n&&(o=W(n,i,this.currentLocale,this.tokenRegex)),o},N.prototype.has=function(e){return x(this.phrases,e)},N.transformPhrase=function(e,t,n){return W(e,t,n)};var H=window.webix;H&&v(H);var F=window;F.Promise||(F.Promise=F.webix.promise)},function(e,t,n){"use strict";n.r(t),n.d(t,"emptyWidth",(function(){return o})),n.d(t,"bSpace",(function(){return i})),n.d(t,"tables_excludeColumns",(function(){return r})),n.d(t,"screens",(function(){return a})),n.d(t,"menu_options",(function(){return s})),n.d(t,"arrivals_menu_options_excludes",(function(){return c})),n.d(t,"balance_menu_options_excludes",(function(){return l})),n.d(t,"orders_menu_options_excludes",(function(){return u})),n.d(t,"shipments_menu_options_excludes",(function(){return d}));var o=7,i=4,r=["n_state","_checked"],a={arrivals:{name:"Поступления",id:"_arrivals",width:140},movings:{name:"Перемещения",id:"_movings",width:120},transfers:{name:"В розницу",id:"_transfers",width:120},shipments:{name:"Отгрузки",id:"_shipments",width:120},info:{id:"_mView",width:120,name:void 0},balance:{id:"_balance",name:"Остатки",width:100},orders:{name:"Заказы",id:"_orders",width:120}},s=[{id:1,value:"Скопировать поле"},{id:1e3,$template:"Separator"},{id:9,value:"Создать новый документ",submenu:[{id:901,value:"Приходный документ"},{id:902,value:"Отгрузка"},{id:903,value:"Возврат"},{id:904,value:"Вывод из оборота"},{id:905,value:"В розницу"},{id:906,value:"Перемещение"}]},{id:2,value:"Загрузить документ"},{id:1001,$template:"Separator"},{id:3,value:"Провести"},{id:4,value:"Отменить"},{id:5,value:"Корректировка"},{id:6,value:"Удалить"},{id:7,value:"Отменить удаление"},{id:1002,$template:"Separator"},{id:100,value:"Внутренние",submenu:[{id:101,value:"В розницу"},{id:102,value:"Перемещение"}]},{id:200,value:"Внешние",submenu:[{id:201,value:"Отгрузка"},{id:202,value:"Возврат"},{id:203,value:"Вывод из оборота"}]},{id:1003,$template:"Separator"},{id:300,value:"Документ",submenu:[{id:301,value:"Печатная форма"},{id:302,value:"Печатная форма 1"},{id:303,value:"Печатная форма 2"}]},{id:1004,$template:"Separator"},{id:10,value:"Подчиненные документы"}],c=[903,904,905,906,1002,100,101,102,200,201,202,203,1004,10],l=[903,904,905,906,1001,3,4,5,6,7,1002,100,101,102,200,201,202,203,1004,10],u=[903,904,905,906,2,1001,3,4,5,6,7,100,101,102,202,203],d=[903,904,905,906,2,1002,100,101,102,200,201,202,203,1004,10]},function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"w",(function(){return r})),n.d(t,"t",(function(){return a})),n.d(t,"z",(function(){return s})),n.d(t,"r",(function(){return c})),n.d(t,"y",(function(){return l})),n.d(t,"l",(function(){return u})),n.d(t,"m",(function(){return d})),n.d(t,"x",(function(){return h})),n.d(t,"g",(function(){return p})),n.d(t,"B",(function(){return f})),n.d(t,"n",(function(){return _})),n.d(t,"C",(function(){return m})),n.d(t,"o",(function(){return b})),n.d(t,"E",(function(){return w})),n.d(t,"q",(function(){return g})),n.d(t,"D",(function(){return v})),n.d(t,"p",(function(){return y})),n.d(t,"h",(function(){return $})),n.d(t,"A",(function(){return x})),n.d(t,"i",(function(){return O})),n.d(t,"k",(function(){return k})),n.d(t,"j",(function(){return j})),n.d(t,"c",(function(){return C})),n.d(t,"e",(function(){return I})),n.d(t,"d",(function(){return E})),n.d(t,"v",(function(){return S})),n.d(t,"u",(function(){return P})),n.d(t,"F",(function(){return V})),n.d(t,"b",(function(){return R})),n.d(t,"G",(function(){return T})),n.d(t,"s",(function(){return W})),n.d(t,"a",(function(){return N}));var o=n(0);function i(e,t){var n=void 0;t.$scope&&t.$scope.parent&&t.$scope.parent.doc_type&&("Отгрузка"==t.$scope.parent.doc_type?n="shipment":"Приходная накладная"==t.$scope.parent.doc_type&&(n="arrival"));var i={method:"get_filter_list",kwargs:{user:Object(o.getUser)(),filterName:t.config.parentName,docType:n}};return Object(o.request)(i).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function r(e,t){var n=t.$scope.cfg,i={method:"get_ref_filters",kwargs:{user:Object(o.getUser)(),reference:n.reference,field:n.name}};return Object(o.request)(i).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function a(e,t){var n={method:"get_product_filters",kwargs:{user:Object(o.getUser)(),filterName:t.config.parentName}};return Object(o.request)(n).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function s(e,t){var n={method:"shipments.save_shipments_document",kwargs:{user:Object(o.getUser)(),doc_data:e,intable:t}};return Object(o.checkResponse)(Object(o.request)(n,!0).response,"s")}function c(e){var t={method:"shipments.get_shipments_document",kwargs:{user:Object(o.getUser)(),doc_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function l(e,t){var n={method:"arrivals.save_arrivals_document",kwargs:{user:Object(o.getUser)(),doc_data:e,intable:t}};return Object(o.checkResponse)(Object(o.request)(n,!0).response,"s")}function u(e){var t={method:"orders.get_orders_document",kwargs:{user:Object(o.getUser)(),doc_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function d(e){var t={method:"orders.get_orders_document_for_shipment",kwargs:{user:Object(o.getUser)(),doc_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function h(e,t){var n={method:"arrivals.save_arrivals_document",kwargs:{user:Object(o.getUser)(),doc_data:e,intable:t}};return Object(o.checkResponse)(Object(o.request)(n,!0).response,"s")}function p(e){var t={method:"arrivals.get_arrivals_document",kwargs:{user:Object(o.getUser)(),doc_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function f(e){var t={method:"save_partner",kwargs:{user:Object(o.getUser)(),doc_data:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function _(e){var t={method:"get_partner",kwargs:{user:Object(o.getUser)(),p_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function m(e){var t={method:"save_point",kwargs:{user:Object(o.getUser)(),doc_data:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function b(e){var t={method:"get_point",kwargs:{user:Object(o.getUser)(),p_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function w(e,t){var n={method:"save_ref_element",kwargs:{user:Object(o.getUser)(),doc_data:e,reference:t}},i=Object(o.checkResponse)(Object(o.request)(n,!0).response,"s");return i.data[0].hasOwnProperty("n_type_name")?i.data[0].n_type=i.data[0].n_type_name:i.data[0].hasOwnProperty("c_cat_name")?i.data[0].c_cat=i.data[0].c_cat_name:i.data[0].hasOwnProperty("c_dir_name")?i.data[0].c_dir=i.data[0].c_dir_name:i.data[0].hasOwnProperty("c_parent_name")&&(i.data[0].c_parent=i.data[0].c_parent_name),i}function g(e,t){var n={method:"get_ref_element",kwargs:{user:Object(o.getUser)(),p_id:e,reference:t}};return Object(o.checkResponse)(Object(o.request)(n,!0).response,"s")}function v(e){var t={method:"save_product_card",kwargs:{user:Object(o.getUser)(),doc_data:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function y(e){var t={method:"get_product",kwargs:{user:Object(o.getUser)(),p_id:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function $(e){var t={method:"balance.get_products",kwargs:{user:Object(o.getUser)(),ids:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function x(e){console.log("data");var t={method:"balance.set_charge_to_price",kwargs:{user:Object(o.getUser)(),data:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function O(e){var t={method:"get_credentionals",kwargs:{user:e}};return Object(o.checkResponse)(Object(o.request)(t,!0).response,"s")}function k(e,t){var n={method:"get_login",kwargs:{user:e,pwd:t}};return Object(o.checkResponse)(Object(o.request)(n,!0).response,"s")}function j(){var e={method:"get_new_id",kwargs:{user:Object(o.getUser)()}};return Object(o.checkResponse)(Object(o.request)(e,!0).response,"s")}function C(e){var t={method:"check_prod_code",kwargs:{user:Object(o.getUser)(),code:e}},n=Object(o.checkResponse)(Object(o.request)(t,!0).response,"s");return!(!n||!n.data||!0!==n.data)}function I(e){var t={method:"create_price",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(t).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function E(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=localStorage.getItem("opened"),o=new Set;if(t)n&&(o=new Set(n.split(";"))).delete(e);else{if(n&&(o=new Set(n.split(";"))).has(e))return!1;o.add(e)}return o=(o=Array.from(o)).join(";"),localStorage.setItem("opened",o),!0}function S(e,t){var n={n_name:t.cfg.topParent.getFilter(),reference:t.cfg.name};e||(e={sort:$$(t.cfg.id).config.sorting}),e=Object.assign(e,{filters:n}),$$(t.cfg.id).config.sorting=e.sort;var i={method:"get_reference",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(i).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function P(e,t){var n={c_name:t.cfg.topParent.getFilter()};e||(e={sort:t.config.sorting}),e=Object.assign(e,{filters:n}),t.config.sorting=e.sort;var i={method:"get_products",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(i).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function V(e,t){var n={n_product:t.$scope.getFilter()};e||(e={sort:t.config.sorting}),e=Object.assign(e,{filters:n}),t.config.sorting=e.sort;var i={method:"balance.get_data",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(i).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function R(e,t){var n=t.$scope.app.commonWidgets,i=n&&n.balance.menu_filters?n.balance.menu_filters.getFilters():{};e||(e={sort:t.config.sorting}),i=Object.assign(i,n.balance.header?n.balance.header.getSearch():{}),e=Object.assign(e,{filters:i}),t.config.sorting=e.sort;var r={method:"balance.get_data",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(r).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function T(e,t){var n=t.$scope.app.commonWidgets,i=n&&n.shipments.menu_filters?n.shipments.menu_filters.getFilters():{};e||(e={sort:t.config.sorting}),e=Object.assign(e,{filters:i}),t.config.sorting=e.sort;var r={method:"shipments.get_data",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(r).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function W(e,t){var n=t.$scope.app.commonWidgets,i=n&&n.orders.menu_filters?n.orders.menu_filters.getFilters():{};e||(e={sort:t.config.sorting}),e=Object.assign(e,{filters:i}),t.config.sorting=e.sort;var r={method:"orders.get_data",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(r).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}function N(e,t){var n=t.$scope.app.commonWidgets,i=n&&n.arrivals.menu_filters?n.arrivals.menu_filters.getFilters():{};e||(e={sort:t.config.sorting}),e=Object.assign(e,{filters:i}),t.config.sorting=e.sort;var r={method:"arrivals.get_data",kwargs:{user:Object(o.getUser)(),filters:e}};return Object(o.request)(r).then((function(e){return e=Object(o.checkResponse)(e,"a")}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(23),i=n(21),r=n(22),a={arrival:function(){var e=$$("sklad_main_ui").$scope,t=e.app.commonWidgets.sidebar.screens._arrivals?$$("_arrivals_main"):void 0,n=e.ui(new i.a(e.app)),o={flag_new:!0,n_dt_invoice:new Date,n_executor:e.app.config.user,n_paid:"Нет",n_state:1,n_recipient_id:e.app.config.home_org_id,_block:"recipient"};n.show(o,webix.UIManager.getFocus(),t)},shipment:function(e,t){var n=$$("sklad_main_ui").$scope,o=n.app.commonWidgets.sidebar.screens._shipments?$$("_shipments_main"):void 0,i=n.ui(r.a),a={flag_new:!0,n_dt_invoice:new Date,n_executor:n.app.config.user,n_paid:"Нет",n_state:1,n_supplier_id:n.app.config.home_org_id,order_id:t?t.n_id:void 0,n_recipient_id:t?t.n_recipient_id:void 0};i.show(a,webix.UIManager.getFocus(),o)},order:function(){var e=$$("sklad_main_ui").$scope,t=e.app.commonWidgets.sidebar.screens._orders?$$("_orders_main"):void 0,n=e.ui(o.a),i={flag_new:!0,n_dt_invoice:new Date,n_executor:e.app.config.user,n_paid:"Нет",n_state:1,n_recipient_id:e.app.config.home_org_id,_block:"recipient"};n.show(i,webix.UIManager.getFocus(),t)}}},function(e,t,n){"use strict";var o=n(1);n(0);var i=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.element_id=i,r.global_this=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"button",localId:"__button",type:"icon",width:32,icon:"mdi-filter-remove-outline",label:"",css:"remove_filter",on:{onItemClick:function(){e.global_this.$$(e.element_id).setValue()}}}},t.prototype.click=function(){this.$$("__button").callEvent("onItemClick")},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c);t.a=i},function(e,t,n){"use strict";var o=n(1),i=n(0),r=n(2),a=n(3);var s=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=Object.assign({width:150,labelName:"label",labelWidth:100,labelPosition:"top",name:"c_label",fitMaster:!1},o||{}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e;return(e={view:"combo",name:this.cfg.name,localId:"__"+this.cfg.name,label:this.cfg.labelName,labelPosition:this.cfg.labelPosition,labelWidth:this.cfg.labelWidth,tooltip:!0,height:"top"===this.cfg.labelPosition?60:38,inputHeight:38,width:this.cfg.width}).tooltip=function(e){return e.text},e.options={fitMaster:this.cfg.fitMaster,body:{tooltip:!0,width:1.2*+this.cfg.width,parentName:this.cfg.name,yCount:5,scroll:!0,url:function(e){return Object(a.t)(e,this)},type:{height:32}}},e.value=this.cfg.value,e},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c);var c=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.edided=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,n={cols:[{view:"combo",name:"c_type",localId:"__c_type",label:"Тип товара",labelPosition:"left",labelWidth:77,width:275,tooltip:!0,options:{fitMaster:!1,body:(e={tooltip:!0,type:{width:"auto"},autowidth:!0,parentName:"c_type",yCount:5,scroll:!0,data:[{id:1,value:"Лекарственное средство"},{id:2,value:"Прочие товары"}]},e.type={height:32},e)},value:1},{width:2*r.emptyWidth},{view:"combo",tooltip:!0,name:"c_gvnls",localId:"__c_gvnls",label:"ЖВНЛС",labelPosition:"left",labelWidth:55,width:130,options:{body:{tooltip:!0,parentName:"c_gvnls",yCount:5,scroll:!0,data:[{id:1,value:"Да"},{id:2,value:"Нет"}],type:{height:32}}},value:2},{width:2*r.emptyWidth},new s(this.app,{width:150,labelName:"НДС",labelWidth:35,labelPosition:"left",name:"c_vatid",value:"2006552811470000003",fitMaster:!0}),{minWidth:2*r.emptyWidth},{view:"text",name:"c_nnt",localId:"__c_nnt",label:"Код товара",tooltip:!0,labelPosition:"left",labelWidth:77,width:250,value:""},{view:"button",width:50,label:"ID",localId:"__gen_code",tooltip:"Сгенерировать автоматически",on:{onItemClick:function(){var e=Object(a.j)();e&&e.data&&t.$$("__c_nnt").setValue(e.data)}}}]},o={cols:[new s(this.app,{width:330,labelName:"Группа",name:"c_gpid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Форма выпуска",name:"c_rfid",fitMaster:!0}),{width:2*r.emptyWidth},{view:"text",name:"c_doseval",tooltip:!0,localId:"__c_dosval",label:"Дозировка",labelPosition:"top",height:60,inputHeight:38,labelWidth:75,width:80,value:""},new s(this.app,{width:80,labelName:"<span style='color: transparent'>_</span>",name:"c_doseid",fitMaster:!0}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"СПЕ",name:"c_speid",fitMaster:!1})]};return{view:"cWindow",loclalId:"_popup",point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},body:{rows:[{view:"form",localId:"__p_form",on:{onChange:function(){t.setChange()}},elements:[n,{cols:[{view:"text",hidden:!0,name:"c_id",value:""},{view:"text",css:"card_text_field",name:"c_name",height:60,inputHeight:38,localId:"__c_name",label:"Наименование товара",labelPosition:"top",labelWidth:180,value:""},{rows:[{},{view:"button",label:"COP",width:50,tooltip:"Скопировать в полное название",localId:"__copy",on:{onItemClick:function(){var e=t.$$("__c_name").getValue();t.$$("__c_namefull").setValue(e)}}}]}]},{view:"text",name:"c_namefull",css:"card_text_field",localId:"__c_namefull",height:60,inputHeight:38,label:"Полное наименование товара",labelPosition:"top",labelWidth:180,value:""},{cols:[new s(this.app,{width:330,labelName:"МНН",name:"c_mnnid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:330,labelName:"Производитель",name:"c_manid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:330,labelName:"Страна производства",name:"c_mancid",fitMaster:!1})]},o,{cols:[{view:"text",name:"c_pack",tooltip:!0,localId:"__c_pack",label:"Упаковка",labelPosition:"top",height:60,inputHeight:38,labelWidth:70,width:244,value:""},{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Первичная упаковка",name:"c_ppid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Вторичная упаковка",name:"c_psid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Третичная упаковка",name:"c_ptid",fitMaster:!1})]},{cols:[new s(this.app,{width:244,labelName:"Область применения",name:"c_aaid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Направление",name:"c_dirid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Мегакатегория",name:"c_megaid",fitMaster:!1}),{width:2*r.emptyWidth},new s(this.app,{width:244,labelName:"Категория",name:"c_catid",fitMaster:!1})]}]},{borderless:!1,padding:4,cols:[{},{view:"button",label:"Сохранить",width:136,hidden:!0,localId:"__save",on:{onItemClick:function(){var e=t.saveCard();e?Object(i.message)(e,"error",3):(t.setUnChange(),t.hide())}}},{view:"button",label:"Отменить",width:136,localId:"__cancel",on:{onItemClick:function(){t.hide()}}}]}]}}},t.prototype.show=function(){var e="Карточка товара. ";return this.edided?e+=this.edided.c_name:e+="Новый товар",this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.setUnChange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>')},t.prototype.parseProduct=function(e){var t=void 0;e&&(t=e.c_id,this.$$("__gen_code").disable(),this.$$("__c_nnt").disable());var n=Object(a.p)(t);if(this.$$("__p_form").blockEvent(),n){var o=n.data[0];this.$$("__p_form").parse(o)}this.$$("__p_form").unblockEvent()},t.prototype.validateCard=function(e){var t=!1;return(!e.c_name||e.c_name.length<2)&&(t="Укажите название товара"),(!e.c_namefull||e.c_namefull.length<2)&&(t="Укажите полное название товара"),e.c_nnt||(t="Укажите код товара"),this.edided||Object(a.c)(e.c_nnt)||(t="Код товара не уникален"),t},t.prototype.saveCard=function(){var e=this.$$("__p_form").getValues(),t=this.validateCard(e);if(t)return t;var n=$$(this.parent.table_id),o=Object(a.D)(e);return o.data&&o.data[0]?(n&&(this.edided.id?n.updateItem(this.edided.id,o.data[0]):n.add(o.data[0],0)),!1):"Ошибка записи на сервер"},t.prototype.ready=function(){this.parseProduct(this.edided),webix.UIManager.setFocus(this.$$("__c_name"))},t.prototype.init=function(){},t}(o.c);t.a=c},function(e,t,n){"use strict";var o=n(1),i=(n(0),n(20));document.app.states;var r=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.parent_name=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{borderless:!0,cols:[{view:"label",localId:"__1",label:e.getService("common").genLabel(1),width:70,on:{onItemClick:function(){this.$scope.checkTag(this.config.localId,1)}}},{view:"label",localId:"__2",label:e.getService("common").genLabel(2),width:100,on:{onItemClick:function(){this.$scope.checkTag(this.config.localId,2)}}},{view:"label",localId:"__3",label:e.getService("common").genLabel(3),width:100,on:{onItemClick:function(){this.$scope.checkTag(this.config.localId,3)}}},new i.a(e,this.parent_name),{width:10}]}},t.prototype.uncheckAll=function(){var e=this;this.tags.forEach((function(t){e.$$(t).$view.children[0].children[1].classList.add("ordinary_label")}))},t.prototype.setFilter=function(e){this.state!==e&&(this.app.commonWidgets[this.parent_name].menu_filters.setState(e),this.state=e)},t.prototype.checkTag=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.$$(e).$view.children[0].children[1];!o.classList.contains("ordinary_label")&&n?(t="",this.uncheckAll()):(this.uncheckAll(),this.tags.includes(e)&&o.classList.remove("ordinary_label")),n&&this.setFilter(t)},t.prototype.ready=function(){this.app.commonWidgets[this.parent_name].quick_filters=this,this.tags=["__1","__2","__3"]},t.prototype.init=function(){},t}(o.c);t.a=r},function(e,t,n){"use strict";var o=n(1),i=n(0),r=n(2),a=n(3);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(n,o){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(this,t);var r=c(this,e.call(this,n));return r.parent=o,r.readonly=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{localId:"__header-form",borderless:!0,rows:[{view:"text",name:"n_id",localId:"__n_id",disabled:!0,width:0,hidden:!0},{height:r.emptyWidth},{cols:[{view:"text",label:"Исполнитель",labelWidth:100,name:"n_executor",localId:"__exec",disabled:!0,width:250,on:{onChange:function(){e.parent.setChange()}}},{}]},{height:r.emptyWidth},{cols:[{rows:[{template:"Тип документа",type:"section",localId:"__type"},{cols:[{view:"combo",disabled:!0,name:"n_state",label:"Состояние документа",localId:"__status",labelWidth:140,on:{onChange:function(){e.parent.setChange()}},options:{body:{parentName:"n_state",url:function(e){return Object(a.f)(e,this)},type:{height:32},on:{onAfterLoad:function(){}}}}},{width:r.emptyWidth},{view:"text",label:"Номер документа",name:"n_number",labelWidth:120,localId:"__number",on:{onKeyPress:function(e,t){this.callEvent("onChange")},onChange:function(){e.parent.setChange()}}},{width:r.emptyWidth},{view:"datepicker",name:"n_dt_document",label:"Дата документа",format:webix.i18n.dateFormatStr,labelWidth:105,value:new Date,localId:"__date",on:{onChange:function(){e.parent.setChange()}}}]}]},{width:3*r.emptyWidth},{rows:[{template:"Итого по документу",type:"section"},{cols:[{view:"text",label:"Сумма документа",labelWidth:120,format:i.formatText,disabled:!0,localId:"__sum"},{width:r.emptyWidth},{view:"text",label:"Сумма НДС",labelWidth:80,disabled:!0,format:i.formatText,localId:"__vats"},{width:r.emptyWidth},{view:"text",label:"Количество позиций",labelWidth:135,disabled:!0,localId:"__pos"}]}]}]},{height:3*r.emptyWidth},{cols:[{rows:[{template:"поставщик",type:"section"},{view:"combo",disabled:!1,name:"n_supplier",localId:"__supplier",labelWidth:0,on:{onChange:function(){e.parent.setChange()}},options:{body:{parentName:"n_supplier",url:function(e){return Object(a.f)(e,this)},type:{height:32}}}}]},{width:3*r.emptyWidth},{rows:[{template:"получатель",type:"section"},{view:"combo",name:"n_recipient",disabled:!1,localId:"__recipient",labelWidth:0,on:{onChange:function(){e.parent.setChange()}},options:{body:{parentName:"n_recipient",url:function(e){return Object(a.f)(e,this)},type:{height:32}}}}]},{width:3*r.emptyWidth},{rows:[{template:"основание документа",type:"section"},{view:"text",name:"n_base",labelWidth:0,localId:"__base",on:{onKeyPress:function(){this.callEvent("onChange")},onChange:function(){e.parent.setChange()}}}]}]},{height:3*r.emptyWidth}]}},t.prototype.getData=function(e){var t=this,n={};return e||(e=this.getRoot()),e.getChildViews().forEach((function(e,o){var i=t.getData(e);if(n=Object.assign(i,n),e.config.name){var r={};r[e.config.name]=e.getValue(name),n=Object.assign(n,r)}})),n},t.prototype.setHeader=function(){this.parent.doc&&(this.$$("__number").blockEvent(),this.$$("__exec").blockEvent(),this.$$("__date").blockEvent(),this.$$("__status").blockEvent(),this.$$("__supplier").blockEvent(),this.$$("__recipient").blockEvent(),this.$$("__base").blockEvent(),this.$$("__sum").setValue(this.parent.doc.n_summ),this.$$("__vats").setValue(this.parent.doc.n_nds),this.$$("__pos").setValue(this.parent.doc.n_pos_numbers),this.$$("__status").setValue(this.parent.doc.n_state),this.$$("__supplier").setValue(this.parent.doc.n_supplier_id),this.$$("__recipient").setValue(this.parent.doc.n_recipient_id),this.$$("__number").setValue(this.parent.doc.n_number),this.$$("__exec").setValue(this.parent.doc.n_executor),this.$$("__date").setValue(this.parent.doc.n_dt_invoice),this.$$("__base").setValue(this.parent.base?this.parent.base:this.parent.doc.n_base),this.$$("__n_id").setValue(this.parent.doc.n_id),this.$$("__type").define("template",this.parent.doc_type),this.$$("__type").refresh(),this.$$("__number").unblockEvent(),this.$$("__exec").unblockEvent(),this.$$("__date").unblockEvent(),this.$$("__status").unblockEvent(),this.$$("__supplier").unblockEvent(),this.$$("__recipient").unblockEvent(),this.$$("__base").unblockEvent(),2===this.parent.doc.n_state&&(this.$$("__number").disable(),this.$$("__exec").disable(),this.$$("__date").disable(),this.$$("__status").disable(),this.$$("__supplier").disable(),this.$$("__recipient").disable(),this.$$("__base").disable()),this.readonly&&this.$$("__header-form").disable(),this.parent.base&&(this.$$("__base").disable(),this.$$("__recipient").disable()),this.parent._block&&this.$$("__"+this.parent._block).disable())},t.prototype.recalcHeader=function(e){function t(t){var n=0;return e.mapCells(null,t,null,1,(function(e){var t=+e;return isNaN(t)||(n+=t),e})),n}this.$$("__sum").setValue(t("n_total_summ")),this.$$("__vats").setValue(t("n_vats_summ")),this.$$("__pos").setValue(t("n_amount"))},t.prototype.ready=function(){this.setHeader()},t.prototype.init=function(){},t}(o.c);t.a=l},function(e,t,n){"use strict";var o=n(1);n(0);var i=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"datatable",id:this.cfg.id,borderless:!0,name:this.cfg.name||"_table_",clipboard:!0,localId:"__table",navigation:"row",select:"row",datafetch:30,datathrottle:10,loadahead:40,resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,url:function(t){return e.cfg.loadFunction(t,e)},headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:this.cfg.columns,sorting:this.cfg.sorting,onClick:{},onContext:{},on:{onAfterSelect:function(){this.getSelectedId()?this.$scope.cfg.topParent.$$("__edit").show():this.$scope.cfg.topParent.$$("__edit").hide()},onAfterLoad:function(){this.blockEvent(),this.markSorting(this.config.sorting.id,this.config.sorting.dir),this.unblockEvent()},onKeyPress:function(e,t){if(13===e){var n=this.getSelectedId();this.callEvent("onItemDblClick",[n])}},onItemDblClick:this.cfg.dblClick}}},t}(o.c);t.a=i},function(e,t,n){"use strict";var o=n(1),i=n(0),r=n(3);var a=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"layout",css:"center_view",cols:[{width:1},{rows:[{height:1},{view:"datatable",borderless:!0,name:"__main",clipboard:!0,id:this.cfg.id,localId:"__table",navigation:"row",select:"row",datafetch:30,datathrottle:10,loadahead:40,resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,url:function(e){return this.$scope.cfg.loadData(e,this)},headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:this.cfg.columns,leftSplit:1,sorting:this.cfg.sorting,onClick:{menubtn:function(e,t,n){return this.$scope.cfg.parent.callContext(e,this)}},onContext:{webix_ss_center:function(e,t){return this.$scope.cfg.parent.callContext(e,this)}},on:{onCheck:function(e,t,n){n?this.select(e,!0):this.unselect(e,!0)},onAfterLoad:function(){this.markSorting(this.config.sorting.id,this.config.sorting.dir)},onKeyPress:function(e,t){if(13===e){var n=this.getSelectedId();this.callEvent("onItemDblClick",[n])}},onItemDblClick:function(e){if(e){var t=Object(r.d)(this.getItem(e).n_id);if(console.log("perm",t),t){var n=webix.UIManager.getFocus();this.$scope.ui(this.$scope.cfg.docBody).show(this.getItem(e),n,this.$scope.$$("__table"))}else Object(i.message)("Этот документ уже открыт","debug",3)}}}},{height:1}]},{width:1}]}},t}(o.c);t.a=a},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(2),r=n(0),a=n(3),s=n(5);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_pop",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!1,css:"menu_filters",on:{onShow:function(){e.loadValues()}},body:{rows:[{view:"form",autoheight:!0,borderless:!1,localId:"__body",rows:[]},{borderless:!1,cols:[{},{view:"button",width:136,label:"Сбросить все",on:{onItemClick:function(){Array.from(document.getElementsByClassName("remove_filter")).forEach((function(e){var t=webix.html.locate(e,"view_id");$$(t).$scope.click()}))}}},{view:"button",label:"Применить",width:136,localId:"__apply",on:{onItemClick:function(){if(e.isVisible()){var t=e.$$("__body").getValues().n_state;t?e.app.commonWidgets.arrivals.quick_filters.checkTag("__"+t,t,!1):e.app.commonWidgets.arrivals.quick_filters.uncheckAll()}e.app.commonWidgets.arrivals.center_table.getData(),e.saveValues(),e.hide()}}}]}]}}},t.prototype.setState=function(e){this.$$("__n_state_field").setValue(e),this.$$("__apply").callEvent("onItemClick")},t.prototype.saveValues=function(){this.values=this.$$("__body").getValues(),this.app.commonWidgets.arrivals.status_bar.setStatus(this.values)},t.prototype.loadValues=function(){this.$$("__body").setValues(this.values)},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.getFiltersValue=function(){var e={},t=this.$$("__body").getChildViews();for(var n in t){var o=t[n].getChildViews()[0];e[o.config.name]=o.getText?o.getText():o.getValue()}return e},t.prototype.getFilters=function(){return this.$$("__body").getValues()},t.prototype.ready=function(){var e=this;this.values={};var t=this;this.app.commonWidgets.arrivals.menu_filters=this,setTimeout((function(){e.app.commonWidgets.arrivals.center_table.getHeaders().forEach((function(n){n.id;switch(n.filter_type){case"text":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"text",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"date":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{localId:"__"+n.id+"_field",view:"daterangepicker",multiselect:!0,label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"multi":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"multiselect",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120,options:{view:"multisuggest",button:!0,body:{parentName:n.id,yCount:5,scroll:!0,url:function(e){return Object(a.f)(e,this)},type:{height:32}}}},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"combo":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"combo",label:n.header[0].text||"Состояние",name:n.id,localId:"__"+n.id+"_field",labelWidth:120,options:{body:{parentName:n.id,url:function(e){return Object(a.f)(e,this)},type:{height:32},on:{onAfterLoad:function(){this.add({$empty:!0,value:""},0)}}}}},new s.a(e.app,t,"__"+n.id+"_field")]})}}))}),500)},t.prototype.show=function(e){return this.getRoot().show(e.$view)},t.prototype.hide=function(){return this.getRoot().hide()},t}(o.c);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"button",localId:"_bFilter",type:"icon",width:100,icon:"mdi-filter",label:"Фильтры",on:{onItemClick:function(){this.$scope.menuFilters.isVisible()?this.$scope.menuFilters.hide():this.$scope.menuFilters.show(this)}}}},t.prototype.buttonClick=function(){this.$$("_bFilter").callEvent("onItemClick")},t.prototype.ready=function(){this.app.commonWidgets.arrivals.button_filter=this},t.prototype.init=function(){this.menuFilters=this.ui(u)},t}(o.c);function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){return f(this,t),_(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{borderless:!0,cols:[{view:"label",autowidth:!0,label:"Фильтры: ",on:{onItemClick:function(){e.app.commonWidgets.arrivals.button_filter.buttonClick()}}},{width:i.bSpace},{view:"label",autowidth:!0,css:"status_bar",localId:"__status",label:"нет",on:{onItemClick:function(){e.app.commonWidgets.arrivals.button_filter.buttonClick()}}}]}},t.prototype.setStatus=function(){var e=this.app.commonWidgets.arrivals.menu_filters.getFiltersValue(),t=[];for(var n in e){var o=e[n];if(o){var i=document.app.translates[n].value;t.push(i+": "+o)}}t=t.length>0?t.join("; "):"нет",this.$$("__status").define({label:t,tooltip:t}),this.$$("__status").refresh(),this.$$("__status").resize()},t.prototype.ready=function(){this.$$("__status").resize(),this.app.commonWidgets.arrivals.status_bar=this},t.prototype.init=function(){},t}(o.c),b=(n(25),n(7));function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v,y=function(e){function t(){return w(this,t),g(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{borderless:!0,rows:[{view:"toolbar",borderless:!0,margin:0,cols:[{view:"label",label:"<span class='label_highlited'>Поступления</span>",autowidth:!0,css:"label_highlited",hidden:!0},{width:i.emptyWidth},{},new b.a(this.app,"arrivals"),p]},{height:26,borderless:!0,cols:[{view:"label",hidden:!0,autowidth:!0,label:"Название юр. лица:",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{view:"label",hidden:!0,css:"italic",autowidth:!0,label:"ООО Организация",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{width:i.emptyWidth},{$subview:m,name:"status_bar"}]}]}},t.prototype.changeOrganization=function(e,t){Object(r.message)("Смена организации"),console.log("commonWidg",this.app.commonWidgets)},t.prototype.ready=function(){this.app.commonWidgets.arrivals.header=this},t.prototype.init=function(){},t}(o.c),$=document.app.states,x=[{id:"n_id",hidden:!0,headermenu:!1,width:50,filter_type:"none"},(v={id:"_checked",sort:"server"},v.sort=!1,v.css="center_text",v.hidden=!1,v.tooltip=!1,v.headermenu=!1,v.width=50,v.template="<span class='menubtn mdi-settings'></span>",v.header=[{text:""},{text:""}],v.filter_type="none",v.footer={text:"Всего документов в выборке:",colspan:3},v),{id:"n_state",width:40,sort:!1,tooltip:function(e){return $[e.n_state].value},template:function(e){return"<span class='table_icon "+$[e.n_state].picture+"', style='color: "+$[e.n_state].color+"'></span>"},css:"center_text",header:[{text:""}],headermenu:!1,filter_type:"combo"},{id:"n_number",width:100,sort:"server",header:[{text:Object(r.names)("n_number").value}],headermenu:!1,filter_type:"text"},{id:"n_dt_invoice",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_invoice").value}],headermenu:!1,format:webix.i18n.dateFormatStr,filter_type:"date",footer:{content:"totalTable"}},{id:"n_supplier",width:160,sort:"server",header:[{text:Object(r.names)("n_supplier").value}],headermenu:!1,filter_type:"multi"},{id:"n_supplier_id",width:0,hidden:!0,headermenu:!1},{id:"n_recipient",width:160,sort:"server",header:[{text:Object(r.names)("n_recipient").value}],headermenu:!1,filter_type:"multi"},{id:"n_recipient_id",width:0,hidden:!0,headermenu:!1},{id:"n_summ",width:140,sort:"server",header:[{text:Object(r.names)("n_summ").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_nds",width:120,sort:"server",header:[{text:Object(r.names)("n_nds").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_pos_numbers",width:90,sort:"server",header:[{text:Object(r.names)("n_pos_numbers").value}],headermenu:!1,filter_type:"text"},{id:"n_executor",width:140,sort:"server",header:[{text:Object(r.names)("n_executor").value}],headermenu:!1,filter_type:"multi"},{id:"n_base",sort:"server",fillspace:1,header:[{text:Object(r.names)("n_base").value}],headermenu:!1,filter_type:"text"},{id:"n_paid",width:80,sort:"server",header:[{text:Object(r.names)("n_paid").value}],headermenu:!0,hidden:!0,filter_type:"combo"},{id:"n_dt_change",width:160,sort:"server",header:[{text:Object(r.names)("n_dt_change").value}],format:webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),headermenu:!1,filter_type:"date"}],O=n(4);function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C=function(e){function t(){return k(this,t),j(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app;return{view:"contextmenu",autowidth:!0,localId:"__arrivals_cmenu",css:"context_center_dt",point:!0,on:{onMenuItemClick:function(n,o,i){var a=this.getContext(),s=function(){return a.table.getItem(a.position.row)},c=void 0;switch(n){case"1":var l=s()[a.position.column];navigator.clipboard?navigator.clipboard.writeText(l).then((function(){Object(r.message)("Скопировано в буфер")})):Object(r.message)("Браузер устарел, скопировать в буфер невозможно","error",3);break;case"3":(c=t.getService("common").holdDocument("arrival",s().n_id,s().id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"4":(c=t.getService("common").unHoldDocument("arrival",s().n_id,s().id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"6":(c=t.getService("common").deleteDocument("arrival",s().n_id,s().id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"7":(c=t.getService("common").unDeleteDocument("arrival",s().n_id,s().id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"901":O.a.arrival(e);break;case"902":O.a.shipment(e);break;default:Object(r.message)(this.getMenuItem(n).value)}}}}},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.hide=function(){this.getRoot().hide()},t.prototype.attachTo=function(e){this.getRoot().attachTo(e)},t.prototype.setContext=function(e){this.getRoot().setContext(e)},t.prototype.clearAll=function(){this.getRoot().clearAll()},t.prototype.parse=function(e){this.getRoot().parse(e)},t.prototype.show=function(e,t){var n=this,o=this.getRoot().getContext();this.clearAll(),this.parse(i.menu_options);var r=[];if(r=r.concat(i.arrivals_menu_options_excludes),o.position){var a=o.table.getItem(o.position.row);2==a.n_state?r=r.concat([3,6,7]):1==a.n_state?r=r.concat([4,5,7,100,200,1003]):3==a.n_state&&(r=r.concat([3,4,5,6,100,200,1003])),o.table.select(o.position,!1),i.tables_excludeColumns.includes(o.position.column)&&(r=r.concat([1,1e3]))}else r=r.concat([1,1e3,3,4,5,6,7,1001,1002,1003,100,200,300,1004,10]);(r=Array.from(new Set(r))).forEach((function(e){n.getRoot().hideItem(e)})),this.getRoot().show(e)},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),I=n(21),E=n(10);var S=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.view_name=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e={loadData:a.a,sorting:{id:"n_dt_invoice",dir:"desc"},docBody:I.a,columns:x,parent:this,id:"_arrivals_main",_block:"recipient"};return new E.a(this.app,e)},t.prototype.callContext=function(e,t){var n=t.locate(e);return this.contextDt.setContext({obj:webix.$$(e),table:t,position:n}),this.contextDt.show(e),webix.html.preventEvent(e)},t.prototype.getData=function(){var e=this;this.__table.clearAll(!0),this.__table.loadNext(0,0,0,0,!0).then((function(t){t&&(e.__table.clearAll(!0),e.__table.parse(t),e.__table.showItemByIndex(0))}))},t.prototype.getHeaders=function(){var e=this,t=[];return this.__table.eachColumn((function(n){var o=e.__table.getColumnConfig(n);t.push(o)}),!0),t},t.prototype.ready=function(){this.__table=$$("_arrivals_main"),this.app.commonWidgets.arrivals.center_table=this},t.prototype.init=function(){this.contextDt=this.ui(C)},t}(o.c);var P=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{type:"line",rows:[{$subview:y},{height:2},new S(e,"arrivals")]}},t.prototype.init=function(){},t.prototype.ready=function(){},t}(o.c);t.default=P},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(2),r=n(0),a=n(3),s=n(5);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_pop",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!1,css:"menu_filters",on:{onShow:function(){e.loadValues()}},body:{rows:[{view:"form",autoheight:!0,borderless:!1,localId:"__body",rows:[]},{borderless:!1,cols:[{},{view:"button",width:136,label:"Сбросить все",on:{onItemClick:function(){Array.from(document.getElementsByClassName("remove_filter")).forEach((function(e){var t=webix.html.locate(e,"view_id");$$(t).$scope.click()}))}}},{view:"button",label:"Применить",width:136,localId:"__apply",on:{onItemClick:function(){if(e.isVisible()){var t=e.$$("__body").getValues().n_state;t?e.app.commonWidgets.shipments.quick_filters.checkTag("__"+t,t,!1):e.app.commonWidgets.shipments.quick_filters.uncheckAll()}e.app.commonWidgets.shipments.center_table.getData(),e.saveValues(),e.hide()}}}]}]}}},t.prototype.setState=function(e){this.$$("__n_state_field").setValue(e),this.$$("__apply").callEvent("onItemClick")},t.prototype.saveValues=function(){this.values=this.$$("__body").getValues(),this.app.commonWidgets.shipments.status_bar.setStatus(this.values)},t.prototype.loadValues=function(){this.$$("__body").setValues(this.values)},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.getFiltersValue=function(){var e={},t=this.$$("__body").getChildViews();for(var n in t){var o=t[n].getChildViews()[0];e[o.config.name]=o.getText?o.getText():o.getValue()}return e},t.prototype.getFilters=function(){return this.$$("__body").getValues()},t.prototype.ready=function(){var e=this;this.values={};var t=this;this.app.commonWidgets.shipments.menu_filters=this,setTimeout((function(){e.app.commonWidgets.shipments.center_table.getHeaders().forEach((function(n){n.id;switch(n.filter_type){case"text":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"text",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"date":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{localId:"__"+n.id+"_field",view:"daterangepicker",multiselect:!0,label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"multi":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"multiselect",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120,options:{view:"multisuggest",button:!0,body:{parentName:n.id,yCount:5,scroll:!0,url:function(e){return Object(a.f)(e,this)},type:{height:32}}}},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"combo":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"combo",label:n.header[0].text||"Состояние",name:n.id,localId:"__"+n.id+"_field",labelWidth:120,options:{body:{parentName:n.id,url:function(e){return Object(a.f)(e,this)},type:{height:32},on:{onAfterLoad:function(){this.add({$empty:!0,value:""},0)}}}}},new s.a(e.app,t,"__"+n.id+"_field")]})}}))}),500)},t.prototype.show=function(e){return this.getRoot().show(e.$view)},t.prototype.hide=function(){return this.getRoot().hide()},t}(o.c);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"button",localId:"_bFilter",type:"icon",width:100,icon:"mdi-filter",label:"Фильтры",on:{onItemClick:function(){this.$scope.menuFilters.isVisible()?this.$scope.menuFilters.hide():this.$scope.menuFilters.show(this)}}}},t.prototype.buttonClick=function(){this.$$("_bFilter").callEvent("onItemClick")},t.prototype.ready=function(){this.app.commonWidgets.shipments.button_filter=this},t.prototype.init=function(){this.menuFilters=this.ui(u)},t}(o.c);function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){return f(this,t),_(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{borderless:!0,cols:[{view:"label",autowidth:!0,label:"Фильтры: ",on:{onItemClick:function(){e.app.commonWidgets.shipments.button_filter.buttonClick()}}},{width:i.bSpace},{view:"label",autowidth:!0,css:"status_bar",localId:"__status",label:"нет",on:{onItemClick:function(){e.app.commonWidgets.shipments.button_filter.buttonClick()}}}]}},t.prototype.setStatus=function(){var e=this.app.commonWidgets.shipments.menu_filters.getFiltersValue(),t=[];for(var n in e){var o=e[n];if(o){var i=document.app.translates[n].value;t.push(i+": "+o)}}t=t.length>0?t.join("; "):"нет",this.$$("__status").define({label:t,tooltip:t}),this.$$("__status").refresh(),this.$$("__status").resize()},t.prototype.ready=function(){this.$$("__status").resize(),this.app.commonWidgets.shipments.status_bar=this},t.prototype.init=function(){},t}(o.c),b=(n(25),n(7));function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v,y=function(e){function t(){return w(this,t),g(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{borderless:!0,rows:[{view:"toolbar",borderless:!0,margin:0,cols:[{view:"label",label:"<span class='label_highlited'>Отгрузки</span>",autowidth:!0,css:"label_highlited",hidden:!0},{width:i.emptyWidth},{},new b.a(this.app,"shipments"),p]},{height:26,borderless:!0,cols:[{view:"label",hidden:!0,autowidth:!0,label:"Название юр. лица:",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{view:"label",hidden:!0,css:"italic",autowidth:!0,label:"ООО Организация",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{width:i.emptyWidth},{$subview:m,name:"status_bar"}]}]}},t.prototype.changeOrganization=function(e,t){Object(r.message)("Смена организации"),console.log("commonWidg",this.app.commonWidgets)},t.prototype.ready=function(){this.app.commonWidgets.shipments.header=this},t.prototype.init=function(){},t}(o.c),$=document.app.states,x=[{id:"n_id",hidden:!0,headermenu:!1,width:50,filter_type:"none"},(v={id:"_checked",sort:"server"},v.sort=!1,v.css="center_text",v.hidden=!1,v.tooltip=!1,v.headermenu=!1,v.width=50,v.template="<span class='menubtn mdi-settings'></span>",v.header=[{text:""},{text:""}],v.filter_type="none",v.footer={text:"Всего документов в выборке:",colspan:3},v),{id:"n_state",width:40,sort:!1,tooltip:function(e){return $[e.n_state].value},template:function(e){return"<span class='table_icon "+$[e.n_state].picture+"', style='color: "+$[e.n_state].color+"'></span>"},css:"center_text",header:[{text:""}],headermenu:!1,filter_type:"combo"},{id:"n_number",width:100,sort:"server",header:[{text:Object(r.names)("n_number").value}],headermenu:!1,filter_type:"text"},{id:"n_dt_invoice",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_invoice").value}],headermenu:!1,format:webix.i18n.dateFormatStr,filter_type:"date",footer:{content:"totalTable"}},{id:"n_supplier",width:160,sort:"server",header:[{text:Object(r.names)("n_supplier").value}],headermenu:!1,filter_type:"multi"},{id:"n_supplier_id",width:0,hidden:!0,headermenu:!1},{id:"n_recipient",width:160,sort:"server",header:[{text:Object(r.names)("n_recipient").value}],headermenu:!1,filter_type:"multi"},{id:"n_recipient_id",width:0,hidden:!0,headermenu:!1},{id:"n_charge",width:140,header:[{text:Object(r.names)("n_charge").value}],headermenu:!1,filter_type:"text"},{id:"n_summ",width:140,sort:"server",header:[{text:Object(r.names)("n_summ").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_nds",width:120,sort:"server",header:[{text:Object(r.names)("n_nds").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_pos_numbers",width:90,sort:"server",header:[{text:Object(r.names)("n_pos_numbers").value}],headermenu:!1,filter_type:"text"},{id:"n_executor",width:140,sort:"server",header:[{text:Object(r.names)("n_executor").value}],headermenu:!1,filter_type:"multi"},{id:"n_base",sort:"server",fillspace:1,header:[{text:Object(r.names)("n_base").value}],headermenu:!1,filter_type:"text"},{id:"n_paid",width:80,sort:"server",header:[{text:Object(r.names)("n_paid").value}],headermenu:!0,hidden:!0,filter_type:"combo"},{id:"n_dt_change",width:160,sort:"server",header:[{text:Object(r.names)("n_dt_change").value}],format:webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),headermenu:!1,filter_type:"date"}],O=n(4);function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C=function(e){function t(){return k(this,t),j(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app;return{view:"contextmenu",autowidth:!0,localId:"__shipments_cmenu",css:"context_center_dt",point:!0,on:{onMenuItemClick:function(n,o,i){var a=this.getContext();console.log("row",a.position);var s=a.position?a.table.getItem(a.position.row):void 0,c=void 0;switch(console.log("id",n),n){case"1":var l=s[a.position.column];navigator.clipboard?navigator.clipboard.writeText(l).then((function(){Object(r.message)("Скопировано в буфер")})):Object(r.message)("Браузер устарел, скопировать в буфер невозможно","error",3);break;case"3":(c=t.getService("common").holdDocument("shipment",s.n_id,s.id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"4":(c=t.getService("common").unHoldDocument("shipment",s.n_id,s.id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"6":(c=t.getService("common").deleteDocument("shipment",s.n_id,s.id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"7":(c=t.getService("common").unDeleteDocument("shipment",s.n_id,s.id)).data&&a.table.updateItem(c.kwargs.filters.intable,c.data[0]);break;case"901":O.a.arrival(e);break;case"902":O.a.shipment(e);break;default:Object(r.message)(this.getMenuItem(n).value)}}}}},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.hide=function(){this.getRoot().hide()},t.prototype.attachTo=function(e){this.getRoot().attachTo(e)},t.prototype.setContext=function(e){this.getRoot().setContext(e)},t.prototype.clearAll=function(){this.getRoot().clearAll()},t.prototype.parse=function(e){this.getRoot().parse(e)},t.prototype.show=function(e,t){var n=this,o=this.getRoot().getContext();this.clearAll(),this.parse(i.menu_options);var r=[];if(r=r.concat(i.shipments_menu_options_excludes),o.position){var a=o.table.getItem(o.position.row);2==a.n_state?r=r.concat([3,6,7]):1==a.n_state?r=r.concat([4,5,7,100,200,1003]):3==a.n_state&&(r=r.concat([3,4,5,6,100,200,1003])),o.table.select(o.position,!1),i.tables_excludeColumns.includes(o.position.column)&&(r=r.concat([1,1e3]))}else r=r.concat([1,1e3,3,4,5,6,7,1001,1002,1003,100,200,300,1004,10]);(r=Array.from(new Set(r))).forEach((function(e){n.getRoot().hideItem(e)})),this.getRoot().show(e)},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),I=n(22),E=n(10);var S=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.view_name=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e={loadData:a.G,sorting:{id:"n_dt_invoice",dir:"desc"},docBody:I.a,columns:x,parent:this,id:"_shipments_main"};return new E.a(this.app,e)},t.prototype.callContext=function(e,t){var n=t.locate(e);return this.contextDt.setContext({obj:webix.$$(e),table:t,position:n}),this.contextDt.show(e),webix.html.preventEvent(e)},t.prototype.getData=function(){var e=this;this.__table.clearAll(!0),this.__table.loadNext(0,0,0,0,!0).then((function(t){t&&(e.__table.clearAll(!0),e.__table.parse(t),e.__table.showItemByIndex(0))}))},t.prototype.getHeaders=function(){var e=this,t=[];return this.__table.eachColumn((function(n){var o=e.__table.getColumnConfig(n);t.push(o)}),!0),t},t.prototype.ready=function(){this.__table=$$("_shipments_main"),this.app.commonWidgets.shipments.center_table=this},t.prototype.init=function(){this.contextDt=this.ui(C)},t}(o.c);var P=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{type:"line",rows:[{$subview:y},{height:2},new S(e,"shipments")]}},t.prototype.init=function(){},t.prototype.ready=function(){},t}(o.c);t.default=P},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(2),r=n(0),a=n(3),s=n(5);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_pop",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!1,css:"menu_filters",on:{onShow:function(){e.loadValues()}},body:{rows:[{view:"form",autoheight:!0,borderless:!1,localId:"__body",rows:[]},{borderless:!1,cols:[{},{view:"button",width:136,label:"Сбросить все",on:{onItemClick:function(){Array.from(document.getElementsByClassName("remove_filter")).forEach((function(e){var t=webix.html.locate(e,"view_id");$$(t).$scope.click()}))}}},{view:"button",label:"Применить",width:136,localId:"__apply",on:{onItemClick:function(){if(e.isVisible()){var t=e.$$("__body").getValues().n_state;t?e.app.commonWidgets.orders.quick_filters.checkTag("__"+t,t,!1):e.app.commonWidgets.orders.quick_filters.uncheckAll()}e.app.commonWidgets.orders.center_table.getData(),e.saveValues(),e.hide()}}}]}]}}},t.prototype.setState=function(e){this.$$("__n_state_field").setValue(e),this.$$("__apply").callEvent("onItemClick")},t.prototype.saveValues=function(){this.values=this.$$("__body").getValues(),this.app.commonWidgets.orders.status_bar.setStatus(this.values)},t.prototype.loadValues=function(){this.$$("__body").setValues(this.values)},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.getFiltersValue=function(){var e={},t=this.$$("__body").getChildViews();for(var n in t){var o=t[n].getChildViews()[0];e[o.config.name]=o.getText?o.getText():o.getValue()}return e},t.prototype.getFilters=function(){return this.$$("__body").getValues()},t.prototype.ready=function(){var e=this;this.values={};var t=this;this.app.commonWidgets.orders.menu_filters=this,setTimeout((function(){e.app.commonWidgets.orders.center_table.getHeaders().forEach((function(n){n.id;switch(n.filter_type){case"text":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"text",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"date":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{localId:"__"+n.id+"_field",view:"daterangepicker",multiselect:!0,label:n.header[0].text,name:n.id,labelWidth:120},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"multi":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"multiselect",localId:"__"+n.id+"_field",label:n.header[0].text,name:n.id,labelWidth:120,options:{view:"multisuggest",button:!0,body:{parentName:n.id,yCount:5,scroll:!0,url:function(e){return Object(a.f)(e,this)},type:{height:32}}}},new s.a(e.app,t,"__"+n.id+"_field")]});break;case"combo":e.$$("__body").addView({css:"menu_filters_margin_top",cols:[{view:"combo",label:n.header[0].text||"Состояние",name:n.id,localId:"__"+n.id+"_field",labelWidth:120,options:{body:{parentName:n.id,url:function(e){return Object(a.f)(e,this)},type:{height:32},on:{onAfterLoad:function(){this.add({$empty:!0,value:""},0)}}}}},new s.a(e.app,t,"__"+n.id+"_field")]})}}))}),500)},t.prototype.show=function(e){return this.getRoot().show(e.$view)},t.prototype.hide=function(){return this.getRoot().hide()},t}(o.c);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"button",localId:"_bFilter",type:"icon",width:100,icon:"mdi-filter",label:"Фильтры",on:{onItemClick:function(){this.$scope.menuFilters.isVisible()?this.$scope.menuFilters.hide():this.$scope.menuFilters.show(this)}}}},t.prototype.buttonClick=function(){this.$$("_bFilter").callEvent("onItemClick")},t.prototype.ready=function(){this.app.commonWidgets.orders.button_filter=this},t.prototype.init=function(){this.menuFilters=this.ui(u)},t}(o.c);function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){return f(this,t),_(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{borderless:!0,cols:[{view:"label",autowidth:!0,label:"Фильтры: ",on:{onItemClick:function(){e.app.commonWidgets.orders.button_filter.buttonClick()}}},{width:i.bSpace},{view:"label",autowidth:!0,css:"status_bar",localId:"__status",label:"нет",on:{onItemClick:function(){e.app.commonWidgets.orders.button_filter.buttonClick()}}}]}},t.prototype.setStatus=function(){var e=this.app.commonWidgets.orders.menu_filters.getFiltersValue(),t=[];for(var n in e){var o=e[n];if(o){var i=document.app.translates[n].value;t.push(i+": "+o)}}t=t.length>0?t.join("; "):"нет",this.$$("__status").define({label:t,tooltip:t}),this.$$("__status").refresh(),this.$$("__status").resize()},t.prototype.ready=function(){this.$$("__status").resize(),this.app.commonWidgets.orders.status_bar=this},t.prototype.init=function(){},t}(o.c),b=n(7);function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v,y=function(e){function t(){return w(this,t),g(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{borderless:!0,rows:[{view:"toolbar",borderless:!0,margin:0,cols:[{view:"label",label:"<span class='label_highlited'>Поступления</span>",autowidth:!0,css:"label_highlited",hidden:!0},{width:i.emptyWidth},{},new b.a(this.app,"orders"),p]},{height:26,borderless:!0,cols:[{view:"label",hidden:!0,autowidth:!0,label:"Название юр. лица:",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{view:"label",hidden:!0,css:"italic",autowidth:!0,label:"ООО Организация",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{width:i.emptyWidth},{$subview:m,name:"status_bar"}]}]}},t.prototype.changeOrganization=function(e,t){Object(r.message)("Смена организации"),console.log("commonWidg",this.app.commonWidgets)},t.prototype.ready=function(){this.app.commonWidgets.orders.header=this},t.prototype.init=function(){},t}(o.c),$=document.app.states,x=[{id:"n_id",hidden:!0,headermenu:!1,width:50,filter_type:"none"},(v={id:"_checked",sort:"server"},v.sort=!1,v.css="center_text",v.hidden=!1,v.tooltip=!1,v.headermenu=!1,v.width=50,v.template="<span class='menubtn mdi-settings'></span>",v.header=[{text:""},{text:""}],v.filter_type="none",v),{id:"n_state",width:40,sort:!1,tooltip:function(e){return $[e.n_state].value},template:function(e){return"<span class='table_icon "+$[e.n_state].picture+"', style='color: "+$[e.n_state].color+"'></span>"},css:"center_text",header:[{text:""}],headermenu:!1,filter_type:"combo"},{id:"n_supplier",width:1,header:[{text:Object(r.names)("n_supplier").value}],headermenu:!1,hidden:!0},{id:"n_filename",width:1,header:[{text:Object(r.names)("n_filename").value}],headermenu:!1,hidden:!0},{id:"n_id_field",width:100,sort:"server",header:[{text:Object(r.names)("n_id_field").value}],headermenu:!0,hidden:!0,filter_type:"text"},{id:"n_name",width:240,sort:"server",header:[{text:Object(r.names)("n_name").value}],headermenu:!0,hidden:!0,filter_type:"multi"},{id:"n_recipient",fillspace:1,sort:"server",header:[{text:Object(r.names)("n_recipient").value}],headermenu:!1,filter_type:"multi",footer:{text:"Всего документов в выборке:",colspan:1}},{id:"n_p_id",width:1,sort:"server",header:[{text:Object(r.names)("n_p_id").value}],headermenu:!1,hidden:!0},{id:"n_inn",width:100,sort:"server",header:[{text:Object(r.names)("n_inn").value}],headermenu:!1,hidden:!1,filter_type:"text",footer:{content:"totalTable"}},{id:"n_code",width:100,sort:"server",header:[{text:Object(r.names)("n_code").value}],headermenu:!0,hidden:!0,filter_type:"text"},{id:"n_dt_price",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_price").value}],headermenu:!0,hidden:!0,format:webix.i18n.dateFormatStr,filter_type:"date"},{id:"n_dt_invoice",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_invoice").value}],headermenu:!1,format:webix.i18n.dateFormatStr,filter_type:"date"},{id:"n_number",width:100,sort:"server",header:[{text:Object(r.names)("n_number").value}],headermenu:!0,filter_type:"text"},{id:"n_dt_send",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_send").value}],headermenu:!0,format:webix.i18n.dateFormatStr,filter_type:"date"},{id:"n_recipient_id",width:1,hidden:!0,headermenu:!1},{id:"n_summ",width:140,sort:"server",header:[{text:Object(r.names)("n_summ").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_pos_numbers",width:90,sort:"server",header:[{text:Object(r.names)("n_pos_numbers").value}],headermenu:!1,filter_type:"text"},{id:"n_dt_recieved",width:120,sort:"server",header:[{text:Object(r.names)("n_dt_recieved").value}],format:webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),headermenu:!1,filter_type:"date"},{id:"n_comment",width:120,header:[{text:Object(r.names)("n_comment").value}],headermenu:!0,hidden:!0}],O=n(4);function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C=function(e){function t(){return k(this,t),j(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"contextmenu",autowidth:!0,localId:"__orders_cmenu",css:"context_center_dt",point:!0,on:{onMenuItemClick:function(t,n,o){var i=this.getContext(),a=function(){return i.table.getItem(i.position.row)};switch(t){case"1":var s=a()[i.position.column];navigator.clipboard?navigator.clipboard.writeText(s).then((function(){Object(r.message)("Скопировано в буфер")})):Object(r.message)("Браузер устарел, скопировать в буфер невозможно","error",3);break;case"201":Object(r.message)("отгружаем"),O.a.shipment(e,a());break;case"901":O.a.arrival(e);break;case"902":O.a.shipment(e);break;default:Object(r.message)(this.getMenuItem(t).value)}}}}},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.hide=function(){this.getRoot().hide()},t.prototype.attachTo=function(e){this.getRoot().attachTo(e)},t.prototype.setContext=function(e){this.getRoot().setContext(e)},t.prototype.clearAll=function(){this.getRoot().clearAll()},t.prototype.parse=function(e){this.getRoot().parse(e)},t.prototype.show=function(e,t){var n=this,o=this.getRoot().getContext();this.clearAll(),this.parse(i.menu_options);var r=[];if(r=r.concat(i.orders_menu_options_excludes),o.position){var a=o.table.getItem(o.position.row);2==a.n_state?r=r.concat([3,6,7]):1==a.n_state?r=r.concat([4,5,7,100,1003]):3==a.n_state&&(r=r.concat([3,4,5,6,100,200,1003])),o.table.select(o.position,!1),i.tables_excludeColumns.includes(o.position.column)&&(r=r.concat([1,1e3]))}else r=r.concat([1,1e3,3,4,5,6,7,1001,1002,1003,100,200,300,1004,10]);(r=Array.from(new Set(r))).forEach((function(e){n.getRoot().hideItem(e)})),this.getRoot().show(e)},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),I=n(23),E=n(10);var S=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.view_name=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e={loadData:a.s,sorting:{id:"n_dt_send",dir:"desc"},docBody:I.a,columns:x,parent:this,id:"_orders_main"};return new E.a(this.app,e)},t.prototype.callContext=function(e,t){var n=t.locate(e);return this.contextDt.setContext({obj:webix.$$(e),table:t,position:n}),this.contextDt.show(e),webix.html.preventEvent(e)},t.prototype.getData=function(){var e=this;this.__table.clearAll(!0),this.__table.loadNext(0,0,0,0,!0).then((function(t){t&&(e.__table.clearAll(!0),e.__table.parse(t),e.__table.showItemByIndex(0))}))},t.prototype.getHeaders=function(){var e=this,t=[];return this.__table.eachColumn((function(n){var o=e.__table.getColumnConfig(n);t.push(o)}),!0),t},t.prototype.ready=function(){this.__table=$$("_orders_main"),this.app.commonWidgets.orders.center_table=this},t.prototype.init=function(){this.contextDt=this.ui(C)},t}(o.c);var P=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{type:"line",rows:[{$subview:y},{height:2},new S(e,"orders")]}},t.prototype.init=function(){},t.prototype.ready=function(){},t}(o.c);t.default=P},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(2);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{borderless:!0,cols:[{view:"label",autowidth:!0,label:"Фильтры: ",on:{onItemClick:function(){}}},{width:i.bSpace},{view:"label",autowidth:!0,css:"status_bar",localId:"__status",label:"нет",on:{onItemClick:function(){}}}]}},t.prototype.setStatus=function(){},t.prototype.ready=function(){this.$$("__status").resize(),this.app.commonWidgets.balance.status_bar=this},t.prototype.init=function(){},t}(o.c),c=n(0),l=n(3),u=n(20);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p,f=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{borderless:!0,rows:[{view:"toolbar",borderless:!0,margin:0,cols:[{view:"label",label:"<span class='label_highlited'>Остатки</span>",autowidth:!0,css:"label_highlited",hidden:!0},{width:i.emptyWidth},{view:"text",localId:"__search",label:"",name:"_search",labelWidth:0,hidden:!1,on:{onKeyPress:function(e,t){var n=this;clearTimeout(this.delay),this.delay=setTimeout((function(){n.$scope.app.commonWidgets.balance.center_table.getData()}),850)}}},{},new u.a(this.app,"balance"),{width:i.emptyWidth},{view:"button",type:"htmlbutton",width:35,height:35,longPress:!1,label:"",localId:"__price_upl",template:function(){return e.getService("common").html_button_template("./library/img/price.svg","Выгрузить прайс")},on:{onItemClick:function(e,t){Object(l.e)(),Object(c.message)("Выгрузка прайса")}}},{width:i.emptyWidth}]},{height:26,borderless:!0,cols:[{width:i.emptyWidth},{width:i.emptyWidth},{width:i.emptyWidth},{$subview:s,name:"status_bar"}]}]}},t.prototype.getSearch=function(){try{return{n_product:this.$$("__search").getValue()}}catch(e){return{}}},t.prototype.ready=function(){this.app.commonWidgets.balance.header=this},t.prototype.init=function(){},t}(o.c),_=[{id:"n_id",hidden:!0,headermenu:!1,width:50,filter_type:"none"},(p={id:"_checked",sort:"server"},p.sort=!1,p.css="center_text",p.hidden=!1,p.tooltip=!1,p.headermenu=!1,p.width=50,p.template="<span class='menubtn mdi-settings'></span>",p.header=[{text:""},{text:""}],p.filter_type="none",p),{id:"n_product_id",width:40,header:[{text:Object(c.names)("n_product_id").value}],headermenu:!1,hidden:!0},{id:"n_code",width:180,sort:"server",header:[{text:Object(c.names)("n_code").value}],headermenu:!1,filter_type:"text"},{id:"n_product",fillspace:1,sort:"server",header:[{text:Object(c.names)("n_product").value}],headermenu:!1,filter_type:"text"},{id:"n_consignment",width:180,sort:"server",header:[{text:Object(c.names)("n_consignment").value}],headermenu:!0,filter_type:"text"},{id:"n_dt",width:120,sort:"server",header:[{text:Object(c.names)("n_dt").value}],headermenu:!1,format:webix.i18n.dateFormatStr,filter_type:"date"},{id:"n_warehouse",width:160,sort:"server",header:[{text:Object(c.names)("n_warehouse").value}],headermenu:!0,hidden:!0,filter_type:"combo"},{id:"n_quantity",width:160,sort:"server",header:[{text:Object(c.names)("n_quantity").value}],headermenu:!1,filter_type:"text"},{id:"n_price",width:140,sort:"server",header:[{text:Object(c.names)("n_price").value}],format:webix.Number.formatNumber,headermenu:!0,hidden:!0,filter_type:"text"},{id:"n_vat",width:120,sort:"server",header:[{text:Object(c.names)("n_vat").value}],format:webix.Number.formatNumber,headermenu:!0,hidden:!0,filter_type:"text"},{id:"n_price_price",width:140,sort:"server",header:[{text:Object(c.names)("n_price_price").value}],format:webix.Number.formatNumber,headermenu:!1,filter_type:"text"},{id:"n_vat_included",width:90,header:[{text:Object(c.names)("n_vat_included").value}],headermenu:!0,hidden:!0,filter_type:"combo"}],m=n(4);function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=function(e){function t(){return b(this,t),w(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"contextmenu",autowidth:!0,localId:"__balance_cmenu",css:"context_center_dt",point:!0,on:{onMenuItemClick:function(t,n,o){var i=this.getContext();switch(t){case"1":var r=i.table.getItem(i.position.row)[i.position.column];navigator.clipboard?navigator.clipboard.writeText(r).then((function(){Object(c.message)("Скопировано в буфер")})):Object(c.message)("Браузер устарел, скопировать в буфер невозможно","error",3);break;case"901":m.a.arrival(e);break;case"902":m.a.shipment(e);break;default:Object(c.message)(this.getMenuItem(t).value)}}}}},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.hide=function(){this.getRoot().hide()},t.prototype.attachTo=function(e){this.getRoot().attachTo(e)},t.prototype.setContext=function(e){this.getRoot().setContext(e)},t.prototype.clearAll=function(){this.getRoot().clearAll()},t.prototype.parse=function(e){this.getRoot().parse(e)},t.prototype.show=function(e,t){var n=this,o=this.getRoot().getContext();this.clearAll(),this.parse(i.menu_options);var r=[];if(r=r.concat(i.balance_menu_options_excludes),o.position){var a=o.table.getItem(o.position.row);2==a.n_state?r=r.concat([3,6,7]):1==a.n_state?r=r.concat([4,5,7,100,200,1003]):3==a.n_state&&(r=r.concat([3,4,5,6,100,200,1003])),o.table.select(o.position,!1),i.tables_excludeColumns.includes(o.position.column)&&(r=r.concat([1,1e3]))}else r=r.concat([1,1e3,3,4,5,6,7,1001,1002,1003,100,200,300,1004,10]);(r=Array.from(new Set(r))).forEach((function(e){n.getRoot().hideItem(e)})),this.getRoot().show(e)},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c);var v=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.view_name=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"layout",css:"center_view",cols:[{width:1},{rows:[{height:1},{view:"datatable",borderless:!0,clipboard:!0,localId:"__table",navigation:"row",select:"row",datafetch:30,datathrottle:10,loadahead:40,resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,url:function(e){return Object(l.b)(e,this)},headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:_,leftSplit:1,sorting:{id:"n_product",dir:"asc"},onClick:{menubtn:function(e,t,n){return this.$scope.callContext(e,this)}},onContext:{webix_ss_center:function(e,t){return console.log("e",e),this.$scope.callContext(e,this)}},on:{onCheck:function(e,t,n){n?this.select(e,!0):this.unselect(e,!0)},onAfterLoad:function(){this.markSorting(this.config.sorting.id,this.config.sorting.dir)},onKeyPress:function(e,t){if(13===e){var n=this.getSelectedId();this.callEvent("onItemDblClick",[n])}},onItemDblClick:function(e){}}},{height:1}]},{width:1}]}},t.prototype.callContext=function(e,t){var n=t.locate(e);return this.contextDt.setContext({obj:webix.$$(e),table:t,position:n}),this.contextDt.show(e),webix.html.preventEvent(e)},t.prototype.getData=function(){var e=this;this.__table.clearAll(!0),this.__table.loadNext(0,0,0,0,!0).then((function(t){t&&(e.__table.clearAll(!0),e.__table.parse(t),e.__table.showItemByIndex(0))}))},t.prototype.getHeaders=function(){var e=this,t=[];return this.__table.eachColumn((function(n){var o=e.__table.getColumnConfig(n);t.push(o)}),!0),t},t.prototype.ready=function(){this.__table=this.$$("__table"),this.app.commonWidgets.balance.center_table=this},t.prototype.init=function(){this.contextDt=this.ui(g)},t}(o.c);var y=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{type:"line",rows:[{$subview:f},{height:2},new v(e,"balance")]}},t.prototype.init=function(){this.widget_name="balance",this.app.commonWidgets[this.widget_name]=this},t.prototype.ready=function(){},t}(o.c);t.default=y},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n.r(t);var r=function(e){function t(){return o(this,t),i(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app.config,t=e.production?"Production":"test";return{view:"toolbar",id:"__bar__main_footer",css:"margin0",borderless:!0,cols:[{view:"label",label:"<span class='footer'>Вы находитесь на сервере:  "+location.hostname+" | "+t+" | "+e.name+" | "+e.version+"</span>",height:14}]}},t.prototype.init=function(){this.widget_name="footer"},t.prototype.ready=function(){this.app.commonWidgets[this.widget_name]=this},t}(n(1).c);t.default=r},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(2),r=n(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{id:"__bar__main_header",borderless:!0,rows:[{view:"toolbar",borderless:!0,margin:0,cols:[{view:"label",label:"<span class='label_highlited'>Склад71</span>",autowidth:!0,css:"label_highlited"},{width:3*i.emptyWidth},{view:"label",hidden:!1,width:150,label:"Название юр. лица:",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{width:i.emptyWidth},{view:"label",hidden:!1,localId:"__org_name",css:"italic",autowidth:!0,label:"ООО Организация",on:{onItemClick:function(e,t){this.$scope.changeOrganization(e,t)}}},{},{view:"label",hidden:!1,autowidth:!0,label:"Пользователь:"},{width:i.emptyWidth},{view:"label",hidden:!1,css:"italic",localId:"__uname",autowidth:!0,label:"",on:{onItemClick:function(e,t){}}},{width:i.emptyWidth},{view:"button",label:"logout",width:80,on:{onItemClick:function(){e.getService("common").logout()}}}]}]}},t.prototype.changeOrganization=function(e,t){Object(r.message)("Смена организации"),console.log("commonWidg",this.app.commonWidgets)},t.prototype.setUser=function(){this.$$("__uname").setValue(Object(r.getUser)()),this.$$("__uname").resize()},t.prototype.setOrg=function(){this.$$("__org_name").setValue(this.app.config.home_org),this.$$("__org_name").resize()},t.prototype.ready=function(){this.app.commonWidgets[this.widget_name]=this},t.prototype.init=function(){this.widget_name="header"},t}(o.c);t.default=c},function(e,t,n){var o;"function"==typeof Symbol&&Symbol.iterator;!function(i){"use strict";function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t,n,o,i,a){return r((s=r(r(t,e),r(o,a)))<<(c=i)|s>>>32-c,n);var s,c}function s(e,t,n,o,i,r,s){return a(t&n|~t&o,e,t,i,r,s)}function c(e,t,n,o,i,r,s){return a(t&o|n&~o,e,t,i,r,s)}function l(e,t,n,o,i,r,s){return a(t^n^o,e,t,i,r,s)}function u(e,t,n,o,i,r,s){return a(n^(t|~o),e,t,i,r,s)}function d(e,t){var n,o,i,a,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,p=-271733879,f=-1732584194,_=271733878;for(n=0;n<e.length;n+=16)o=h,i=p,a=f,d=_,h=s(h,p,f,_,e[n],7,-680876936),_=s(_,h,p,f,e[n+1],12,-389564586),f=s(f,_,h,p,e[n+2],17,606105819),p=s(p,f,_,h,e[n+3],22,-1044525330),h=s(h,p,f,_,e[n+4],7,-176418897),_=s(_,h,p,f,e[n+5],12,1200080426),f=s(f,_,h,p,e[n+6],17,-1473231341),p=s(p,f,_,h,e[n+7],22,-45705983),h=s(h,p,f,_,e[n+8],7,1770035416),_=s(_,h,p,f,e[n+9],12,-1958414417),f=s(f,_,h,p,e[n+10],17,-42063),p=s(p,f,_,h,e[n+11],22,-1990404162),h=s(h,p,f,_,e[n+12],7,1804603682),_=s(_,h,p,f,e[n+13],12,-40341101),f=s(f,_,h,p,e[n+14],17,-1502002290),h=c(h,p=s(p,f,_,h,e[n+15],22,1236535329),f,_,e[n+1],5,-165796510),_=c(_,h,p,f,e[n+6],9,-1069501632),f=c(f,_,h,p,e[n+11],14,643717713),p=c(p,f,_,h,e[n],20,-373897302),h=c(h,p,f,_,e[n+5],5,-701558691),_=c(_,h,p,f,e[n+10],9,38016083),f=c(f,_,h,p,e[n+15],14,-660478335),p=c(p,f,_,h,e[n+4],20,-405537848),h=c(h,p,f,_,e[n+9],5,568446438),_=c(_,h,p,f,e[n+14],9,-1019803690),f=c(f,_,h,p,e[n+3],14,-187363961),p=c(p,f,_,h,e[n+8],20,1163531501),h=c(h,p,f,_,e[n+13],5,-1444681467),_=c(_,h,p,f,e[n+2],9,-51403784),f=c(f,_,h,p,e[n+7],14,1735328473),h=l(h,p=c(p,f,_,h,e[n+12],20,-1926607734),f,_,e[n+5],4,-378558),_=l(_,h,p,f,e[n+8],11,-2022574463),f=l(f,_,h,p,e[n+11],16,1839030562),p=l(p,f,_,h,e[n+14],23,-35309556),h=l(h,p,f,_,e[n+1],4,-1530992060),_=l(_,h,p,f,e[n+4],11,1272893353),f=l(f,_,h,p,e[n+7],16,-155497632),p=l(p,f,_,h,e[n+10],23,-1094730640),h=l(h,p,f,_,e[n+13],4,681279174),_=l(_,h,p,f,e[n],11,-358537222),f=l(f,_,h,p,e[n+3],16,-722521979),p=l(p,f,_,h,e[n+6],23,76029189),h=l(h,p,f,_,e[n+9],4,-640364487),_=l(_,h,p,f,e[n+12],11,-421815835),f=l(f,_,h,p,e[n+15],16,530742520),h=u(h,p=l(p,f,_,h,e[n+2],23,-995338651),f,_,e[n],6,-198630844),_=u(_,h,p,f,e[n+7],10,1126891415),f=u(f,_,h,p,e[n+14],15,-1416354905),p=u(p,f,_,h,e[n+5],21,-57434055),h=u(h,p,f,_,e[n+12],6,1700485571),_=u(_,h,p,f,e[n+3],10,-1894986606),f=u(f,_,h,p,e[n+10],15,-1051523),p=u(p,f,_,h,e[n+1],21,-2054922799),h=u(h,p,f,_,e[n+8],6,1873313359),_=u(_,h,p,f,e[n+15],10,-30611744),f=u(f,_,h,p,e[n+6],15,-1560198380),p=u(p,f,_,h,e[n+13],21,1309151649),h=u(h,p,f,_,e[n+4],6,-145523070),_=u(_,h,p,f,e[n+11],10,-1120210379),f=u(f,_,h,p,e[n+2],15,718787259),p=u(p,f,_,h,e[n+9],21,-343485551),h=r(h,o),p=r(p,i),f=r(f,a),_=r(_,d);return[h,p,f,_]}function h(e){var t,n="",o=32*e.length;for(t=0;t<o;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function p(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function f(e){var t,n,o="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),o+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return o}function _(e){return unescape(encodeURIComponent(e))}function m(e){return function(e){return h(d(p(e),8*e.length))}(_(e))}function b(e,t){return function(e,t){var n,o,i=p(e),r=[],a=[];for(r[15]=a[15]=void 0,i.length>16&&(i=d(i,8*e.length)),n=0;n<16;n+=1)r[n]=909522486^i[n],a[n]=1549556828^i[n];return o=d(r.concat(p(t)),512+8*t.length),h(d(a.concat(o),640))}(_(e),_(t))}function w(e,t,n){return t?n?b(t,e):f(b(t,e)):n?m(e):f(m(e))}void 0===(o=function(){return w}.call(t,n,t,e))||(e.exports=o)}()},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(0),r=n(11),a=n(13),s=n(12),c=n(14);var l=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"button",localId:"__button",width:this.cfg.width||102,label:this.cfg.label,on:{onItemClick:function(){e.cfg.callback(e),e.getRoot().getParentView().$scope.hide()}}}},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),u=[{id:"n_id",hidden:!0,headermenu:!1,width:5},{id:"n_name",fillspace:!0,sort:"server",header:[{text:"Название"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"n_parent",width:200,header:[{text:"Юр.лицо"}],headermenu:!1,hidden:!1,filter_type:"text"},{id:"n_address",width:250,header:[{text:"Адрес"}],headermenu:!1,hidden:!1,filter_type:"text"}],d=[{id:"n_id",hidden:!0,headermenu:!1,width:5},{id:"n_name",fillspace:!0,sort:"server",header:[{text:"Название"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"n_inn",width:140,header:[{text:"ИНН"}],headermenu:!0,hidden:!1,filter_type:"text"},{id:"n_type_text",width:140,header:[{text:"Тип контрагента"}],headermenu:!1,hidden:!1,filter_type:"combo"},{id:"n_points",width:140,header:[{text:"Подразделения"}],headermenu:!0,hidden:!0,filter_type:"text"}],h=[{id:"c_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"c_vat",width:100,header:[{text:"Ставка, %"}],headermenu:!0,hidden:!1,filter_type:"text"}],p=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],f=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"c_cat",width:180,header:[{text:"Категория"}],headermenu:!0,hidden:!1,filter_type:"combo"}],_=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],m=[{id:"n_id",hidden:!0,headermenu:!1,width:5},{id:"n_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],b=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],w=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_rusname",fillspace:!0,sort:"server",header:[{text:"Русское наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"c_latname",width:140,header:[{text:"Латинское наименование"}],headermenu:!0,hidden:!1,filter_type:"text"},{id:"c_engname",width:140,header:[{text:"Английское наименование"}],headermenu:!0,hidden:!1,filter_type:"text"}],g=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],v=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],y=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"с_parent",width:160,sort:"server",header:[{text:"Родительская группа"}],headermenu:!1,filter_type:"combo"}],$=[{id:"n_id",hidden:!0,headermenu:!1,width:5},{id:"n_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],x=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],O=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],k=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"}],j=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"с_dir",width:140,sort:"server",header:[{text:"Направление"}],headermenu:!1,filter_type:"combo"}],C=[{id:"с_id",hidden:!0,headermenu:!1,width:5},{id:"c_name",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"с_parent",width:180,sort:"server",header:[{text:"Родительское направление"}],headermenu:!1,filter_type:"combo"}],I=n(3),E=n(6),S=n(9),P=[{id:"c_id",hidden:!0,headermenu:!1,width:5},{id:"c_code",width:150,header:[{text:Object(i.names)("c_code").value}],headermenu:!0,hidden:!1},{id:"c_name",fillspace:!0,sort:"server",header:[{text:Object(i.names)("c_name").value}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"c_namefull",width:250,sort:"server",header:[{text:Object(i.names)("c_namefull").value}],headermenu:!0,hidden:!0},{id:"c_vat",hidden:!0,headermenu:!1,width:5}];var V=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.parent=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,n=this;this.table_id=webix.uid();var o=new S.a(n.app,{columns:P,loadFunction:I.u,sorting:{id:"c_name",dir:"asc"},topParent:n,id:this.table_id,dblClick:function(e){n.$$("__edit").callEvent("onItemClick")}});return(e={view:"cWindow",loclalId:"_popup",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}}}).width=.6*document.documentElement.clientWidth,e.height=.8*document.documentElement.clientHeight,e.body={rows:[{cols:[{view:"text",localId:"__search",label:"",name:"_search",labelWidth:0,width:450,hidden:!1,on:{onKeyPress:function(e,t){var n=this;clearTimeout(this.delay),this.delay=setTimeout((function(){n.$scope.getData()}),850)}}},{},{view:"button",label:"edit",width:50,tooltip:"Редактировать товар",localId:"__edit",hidden:!0,on:{onItemClick:function(){var e=$$(t.table_id).getSelectedItem();t.ui(new E.a(t.app,t,{c_id:e.c_id,c_name:e.c_name,id:e.id})).show()}}},{view:"button",label:"add",width:50,tooltip:"Добавить товар",localId:"__add",on:{onItemClick:function(){t.ui(new E.a(t.app,t,!1)).show()}}}]},o,{borderless:!1,cols:[{},{view:"button",label:"Закрыть",width:136,localId:"__apply",on:{onItemClick:function(){t.hide()}}}]}]},e},t.prototype.searchDuplicates=function(e,t){var n=void 0;return e.eachRow((function(o){var i=e.getItem(o);i.n_prod_id&&i.n_prod_id.toString()===t.toString()&&(n=o)})),n},t.prototype.getData=function(){var e=$$(this.table_id);e.clearAll(!0),e.loadNext(0,0,0,0,1).then((function(t){t&&(e.clearAll(!0),e.parse(t),e.showItemByIndex(0))}))},t.prototype.getFilter=function(){var e="";try{e=this.$$("__search").getValue()}catch(e){}return e},t.prototype.show=function(e){e&&this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.ready=function(){this.$$("__search").focus()},t.prototype.init=function(){},t}(o.c),R=n(2);var T=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=Object.assign({width:150,labelName:"label",labelWidth:100,labelPosition:"top",name:"c_label",fitMaster:!1},o||{}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this;return(e={view:"combo",name:this.cfg.name,localId:"__"+this.cfg.name,label:this.cfg.labelName,labelPosition:this.cfg.labelPosition,labelWidth:this.cfg.labelWidth,tooltip:!0,height:"top"===this.cfg.labelPosition?60:38,inputHeight:38,width:this.cfg.width}).tooltip=function(e){return e.text},e.on={onKeyPress:function(e,n){27===e&&t.cfg.cancel&&t.cfg.cancel.callEvent("onItemClick")}},e.options={fitMaster:this.cfg.fitMaster,body:{tooltip:!0,width:1.2*+this.cfg.width,parentName:this.cfg.name,yCount:5,scroll:!0,url:function(e){return Object(I.w)(e,this)},type:{height:32}}},e.value=this.cfg.value,e},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c);var W=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.edited=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_popup",point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},body:{rows:[{view:"form",localId:"__ref_form",on:{onChange:function(){e.setChange()}},elements:[]},{borderless:!1,padding:4,cols:[{},{view:"button",label:"Сохранить",width:136,hidden:!0,localId:"__save",on:{onItemClick:function(){var t=e.saveCard();t?Object(i.message)(t,"error",3):(e.setUnChange(),e.hide())}}},{view:"button",label:"Отменить",width:136,localId:"__cancel",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.show=function(e){return e=e||"Карточка "+this.parent.header+".  ",this.edited?e+=this.edited[this.app.getService("common").search_key(this.edited,"_name")]:e+="Новый элемент",this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.setUnChange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>')},t.prototype.parseElement=function(e){var t=void 0;if(e){t=e.id;var n=Object(I.q)(t,this.parent.cfg.name);if(this.$$("__ref_form").blockEvent(),n){var o=n.data[0];this.$$("__ref_form").parse(o)}this.$$("__ref_form").unblockEvent()}},t.prototype.validateCard=function(e){var t=!1,n=e[this.app.getService("common").search_key(e,"_name")];return(!n||n.length<2)&&(t="Укажите наименование "),t},t.prototype.saveCard=function(){var e=this.$$("__ref_form").getValues(),t=this.validateCard(e);if(t)return t;var n=Object(I.E)(e,this.parent.cfg.name),o=$$(this.parent.table_id);return n.data&&n.data[0]?(o&&(this.edited.id?o.updateItem(this.edited.id,n.data[0]):o.add(n.data[0],0)),!1):"Ошибка записи на сервер"},t.prototype.ready=function(){var e=this,t=this;setTimeout((function(){var n=e.parent.cfg.columns;e.$$("__ref_form").addView({view:"text",hidden:!0,localId:"__ref_name",name:"ref_name",value:e.parent.cfg.name}),n.forEach((function(n){if(!n.hidden)switch(n.filter_type){case"text":e.$$("__ref_form").addView({view:"text",localId:"__"+n.id+"_field",label:n.header[0].text,labelPosition:"top",height:60,inputHeight:38,width:600,name:n.id,labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}});break;case"combo":e.$$("__ref_form").addView(new T(e.app,{width:600,labelName:n.header[0].text,name:n.id,reference:e.parent.cfg.name,cancel:t.$$("__cancel"),fitMaster:!0}))}})),e.parseElement(e.edited),webix.UIManager.setFocus(e.$$("__ref_form"))}),200)},t.prototype.init=function(){},t}(o.c);var N=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return console.log("parent",o),r.parent=o,r.edited=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_popup",point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},body:{rows:[{view:"form",localId:"__ref_partners_form",on:{onChange:function(){e.setChange()}},padding:2,margin:1,elements:[]},{borderless:!1,padding:4,cols:[{},{view:"button",label:"Сохранить",width:136,hidden:!0,localId:"__save",on:{onItemClick:function(){var t=e.saveCard();t?Object(i.message)(t,"error",3):(e.setUnChange(),e.hide())}}},{view:"button",label:"Отменить",width:136,localId:"__cancel",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.show=function(e){return e=e||"Карточка "+this.parent.header+".  ",this.edited?e+=this.edited[this.app.getService("common").search_key(this.edited,"_name")]:e+="Новый элемент",this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.setUnChange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>')},t.prototype.parseElement=function(e){var t=void 0;if(e){t=e.id;var n=Object(I.n)(t,this.parent.cfg.name);if(this.$$("__ref_partners_form").blockEvent(),n){var o=n.data[0];this.$$("__ref_partners_form").parse(o)}this.$$("__ref_partners_form").unblockEvent()}},t.prototype.validateCard=function(e){return!e.n_name||e.n_name.length<2?"Укажите название":!e.n_namefull||e.n_namefull.length<2?"Укажите полное название":!e.n_address||e.n_address.length<2?"Укажите юридический адрес":(!e.n_actual_address||e.n_actual_address.length<2)&&"Укажите фактический адрес"},t.prototype.saveCard=function(){var e=this.$$("__ref_partners_form").getValues();console.log("data",e);var t=this.validateCard(e);if(t)return t;var n=Object(I.B)(e),o=$$(this.parent.table_id);return n.data&&n.data[0]?(o&&(this.edited.id?o.updateItem(this.edited.id,n.data[0]):o.add(n.data[0],0)),!1):"Ошибка записи на сервер"},t.prototype.ready=function(){var e=this,t=this;setTimeout((function(){e.$$("__ref_partners_form").addView({view:"text",hidden:!0,localId:"__ref_name",name:"ref_name",value:e.parent.cfg.name}),e.$$("__ref_partners_form").addView({cols:[{view:"text",name:"n_id",width:1,hidden:!0,localId:"__n_id_field"},new T(e.app,{width:140,labelName:"Тип контрагента",name:"n_type",reference:e.parent.cfg.name,cancel:t.$$("__cancel"),fitMaster:!0}),{cols:[{view:"text",localId:"__n_name_field",label:"Название",labelPosition:"top",height:60,inputHeight:38,width:400,name:"n_name",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{rows:[{},{view:"button",label:"COPY",width:60,tooltip:"Скопировать в полное название",localId:"__copy_to_full",on:{onItemClick:function(){var t=e.$$("__n_name_field").getValue();e.$$("__n_namefull_field").setValue(t)}}}]}]}]}),e.$$("__ref_partners_form").addView({cols:[{view:"text",localId:"__n_namefull_field",label:"Полное название",labelPosition:"top",height:60,inputHeight:38,width:540,name:"n_namefull",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{rows:[{},{view:"button",label:"COPY",width:60,tooltip:"Скопировать в полное название",localId:"__copy_to_name",on:{onItemClick:function(){var t=e.$$("__n_namefull_field").getValue();e.$$("__n_name_field").setValue(t)}}}]}]}),e.$$("__ref_partners_form").addView({cols:[{view:"text",localId:"__n_inn_field",label:"ИНН",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_inn",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_kpp_field",label:"КПП",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_kpp",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_ogrn_field",label:"ОГРН",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_ogrn",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}),e.$$("__ref_partners_form").addView({cols:[{view:"text",localId:"__n_contact",label:"Контактное лицо",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_contact",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_phone_field",label:"Телефон",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_phone",pattern:webix.patterns.phone,labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_email_field",label:"e-mail",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_email",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}),e.$$("__ref_partners_form").addView({cols:[{view:"text",localId:"__n_address_field",label:"Юридический адрес",labelPosition:"top",height:60,inputHeight:38,width:540,name:"n_address",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{rows:[{},{view:"button",label:"COPY",width:60,tooltip:"Скопировать в фактический адрес",localId:"__copy_to_actual_addr",on:{onItemClick:function(){var t=e.$$("__n_address_field").getValue();e.$$("__n_actual_address_field").setValue(t)}}}]}]}),e.$$("__ref_partners_form").addView({cols:[{view:"text",localId:"__n_actual_address_field",label:"Фатический адрес",labelPosition:"top",height:60,inputHeight:38,width:540,name:"n_actual_address",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{rows:[{},{view:"button",label:"COPY",width:60,tooltip:"Скопировать в юридический адрес",localId:"__copy_to_actual_addr",on:{onItemClick:function(){var t=e.$$("__n_actual_address_field").getValue();e.$$("__n_address_field").setValue(t)}}}]}]}),e.$$("__ref_partners_form").addView({view:"textarea",localId:"__n_comment_field",label:"Комментарий",labelPosition:"top",height:114,inputHeight:76,width:600,name:"n_comment",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}),e.$$("__ref_partners_form").addView({rows:[{template:"Банк",type:"section"},{cols:[{view:"text",localId:"__n_bank_name_field",label:"Название",labelPosition:"top",height:60,inputHeight:38,width:250,name:"n_bank_name",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_bank_bik_field",label:"БИК",labelPosition:"top",height:60,inputHeight:38,width:120,name:"n_bank_bik",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]},{cols:[{view:"text",localId:"__n_bank_k_account_field",label:"Кор.счет.",labelPosition:"top",height:60,inputHeight:38,width:300,name:"n_bank_k_account",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_bank_ch_account_field",label:"Рассчетный счет",labelPosition:"top",height:60,inputHeight:38,width:300,name:"n_bank_ch_account",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}]}),e.parseElement(e.edited),webix.UIManager.setFocus(e.$$("__n_name_field"))}),30)},t.prototype.init=function(){},t}(o.c);var H=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.edited=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;return{view:"cWindow",loclalId:"_popup",point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},body:{rows:[{view:"form",localId:"__ref_points_form",on:{onChange:function(){e.setChange()}},padding:2,margin:1,elements:[]},{borderless:!1,padding:4,cols:[{},{view:"button",label:"Сохранить",width:136,hidden:!0,localId:"__save",on:{onItemClick:function(){var t=e.saveCard();t?Object(i.message)(t,"error",3):(e.setUnChange(),e.hide())}}},{view:"button",label:"Отменить",width:136,localId:"__cancel",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.show=function(e){return e=e||"Карточка "+this.parent.header+".  ",this.edited?e+=this.edited[this.app.getService("common").search_key(this.edited,"_name")]:e+="Новый элемент",this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.setUnChange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>')},t.prototype.parseElement=function(e){var t=void 0;if(e){t=e.id;var n=Object(I.o)(t,this.parent.cfg.name);if(this.$$("__ref_points_form").blockEvent(),n){var o=n.data[0];this.$$("__ref_points_form").parse(o)}this.$$("__ref_points_form").unblockEvent()}},t.prototype.validateCard=function(e){return!e.n_name||e.n_name.length<2?"Укажите название":!e.n_address||e.n_address.length<2?"Укажите адрес":!e.n_parent_id&&"Укажите юр.лицо"},t.prototype.saveCard=function(){var e=this.$$("__ref_points_form").getValues();console.log("data",e);var t=this.validateCard(e);if(t)return t;var n=Object(I.C)(e),o=$$(this.parent.table_id);return n.data&&n.data[0]?(o&&(this.edited.id?o.updateItem(this.edited.id,n.data[0]):o.add(n.data[0],0)),!1):"Ошибка записи на сервер"},t.prototype.ready=function(){var e=this,t=this;setTimeout((function(){e.$$("__ref_points_form").addView({view:"text",hidden:!0,localId:"__ref_name",name:"ref_name",value:e.parent.cfg.name}),e.$$("__ref_points_form").addView({cols:[{view:"text",name:"n_id",width:1,hidden:!0,localId:"__n_id_field"},new T(e.app,{width:200,labelName:"Юр.лицо",name:"n_parent_id",reference:e.parent.cfg.name,cancel:t.$$("__cancel"),fitMaster:!0}),{view:"text",localId:"__n_code_field",label:"Код",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_code",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}),e.$$("__ref_points_form").addView({cols:[{view:"text",localId:"__n_address_field",label:"Адрес",labelPosition:"top",height:60,inputHeight:38,width:540,name:"n_address",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{rows:[{},{view:"button",label:"COPY",width:60,tooltip:"Скопировать в название",localId:"__copy_to_namr",on:{onItemClick:function(){var t=e.$$("__n_address_field").getValue();e.$$("__n_name_field").setValue(t)}}}]}]}),e.$$("__ref_points_form").addView({cols:[{view:"text",localId:"__n_name_field",label:"Название",labelPosition:"top",height:60,inputHeight:38,width:600,name:"n_name",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}),e.$$("__ref_points_form").addView({cols:[{view:"text",localId:"__n_contact",label:"Контактное лицо",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_contact",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_phone_field",label:"Телефон",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_phone",pattern:webix.patterns.phone,labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}},{view:"text",localId:"__n_email_field",label:"e-mail",labelPosition:"top",height:60,inputHeight:38,width:200,name:"n_email",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}]}),e.$$("__ref_points_form").addView({view:"textarea",localId:"__n_comment_field",label:"Комментарий",labelPosition:"top",height:114,inputHeight:76,width:600,name:"n_comment",labelWidth:120,on:{onKeyPress:function(e,n){32===e||e>=48&&e<=90?t.setChange():27===e&&t.$$("__cancel").callEvent("onItemClick")}}}),e.parseElement(e.edited),webix.UIManager.setFocus(e.$$("__n_address_field"))}),30)},t.prototype.init=function(){},t}(o.c);var F=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this;this.table_id=webix.uid();var n=new S.a(t.app,{columns:t.cfg.columns,loadFunction:t.cfg.loadFunction,sorting:t.cfg.sorting,topParent:t,id:this.table_id,name:t.cfg.name,dblClick:function(e){t.$$("__edit").callEvent("onItemClick")}});return{view:"cWindow",loclalId:"_popup",padding:4,point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},width:.6*document.documentElement.clientWidth,height:.8*document.documentElement.clientHeight,body:{rows:[{cols:[{view:"text",localId:"__search",label:"",name:"_search",labelWidth:0,width:450,hidden:!1,on:{onKeyPress:function(e,t){var n=this;clearTimeout(this.delay),this.delay=setTimeout((function(){n.$scope.getData()}),850)}}},{},{view:"button",label:"edit",width:50,tooltip:"Редактировать запись",localId:"__edit",hidden:!0,on:{onItemClick:function(){var t=$$(e.table_id).getSelectedItem();("partners"==e.cfg.name?e.ui(new N(e.app,e,t)):"points"==e.cfg.name?e.ui(new H(e.app,e,t)):e.ui(new W(e.app,e,t))).show()}}},{view:"button",label:"add",width:50,tooltip:"Добавить запись",localId:"__add",on:{onItemClick:function(){("partners"==e.cfg.name?e.ui(new N(e.app,e,!1)):"points"==e.cfg.name?e.ui(new H(e.app,e,!1)):e.ui(new W(e.app,e,!1))).show()}}}]},n,{borderless:!1,cols:[{},{view:"button",label:"Закрыть",width:136,localId:"__apply",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.searchDuplicates=function(e,t){var n=void 0;return e.eachRow((function(o){var i=e.getItem(o);i.n_prod_id&&i.n_prod_id.toString()===t.toString()&&(n=o)})),n},t.prototype.getData=function(){var e=$$(this.table_id);e.clearAll(!0),e.loadNext(0,0,0,0,1).then((function(t){t&&(e.clearAll(!0),e.parse(t),e.showItemByIndex(0))}))},t.prototype.getFilter=function(){var e="";try{e=this.$$("__search").getValue()}catch(e){}return e},t.prototype.show=function(e){this.header=e,this.header&&this.getRoot().getHead().getChildViews()[0].setValue(this.header),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.ready=function(){this.$$("__search").focus()},t.prototype.init=function(){},t}(o.c),D=n(4),A={docs:[{width:120,label:"Поступление",callback:D.a.arrival},{width:120,label:"Отгрузка",callback:D.a.shipment}],refs:[{width:120,label:"Товары",callback:function(e){var t=new V($$("sklad_main_ui").$scope.app);$$("sklad_main_ui").$scope.ui(t).show("Справочник товаров")}},{width:120,label:"Контрагенты",callback:function(){var e={name:"partners",sorting:{id:"n_name",dir:"asc"},loadFunction:I.v,columns:d},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Контрагенты")}},{width:120,label:"Подразделения",callback:function(){var e={name:"points",sorting:{id:"n_name",dir:"asc"},loadFunction:I.v,columns:u},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Подразделения")}},{width:120,label:"НДС",callback:function(){var e={name:"vats",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:h},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("НДС")}},{width:120,label:"Торговые марки",callback:function(){var e={name:"trademarks",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:p},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Торговые марки")}},{width:120,label:"СПЕ",callback:function(){var e={name:"spes",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:f},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("СПЕ")}},{width:120,label:"Формы выпуска",callback:function(){var e={name:"relforms",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:_},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Формы выпуска")}},{width:120,label:"Типы контрагентов",callback:function(){var e={name:"ptypes",sorting:{id:"n_name",dir:"asc"},loadFunction:I.v,columns:m},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Типы контрагентов")}},{width:120,label:"Упаковки",callback:function(){var e={name:"packagings",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:b},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Упаковки")}},{width:120,label:"МНН",callback:function(){var e={name:"mnns",sorting:{id:"c_rusname",dir:"asc"},loadFunction:I.v,columns:w},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("МНН")}},{width:120,label:"Мегакатегории",callback:function(){var e={name:"megacategories",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:g},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Мегакатегории")}},{width:120,label:"Производители",callback:function(){var e={name:"manufacturers",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:v},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Производители")}},{width:120,label:"Группы",callback:function(){var e={name:"groups",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:y},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Группы")}},{width:120,label:"Сотрудники",callback:function(){var e={name:"employees",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:$},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Сотрудники")}},{width:120,label:"Направления",callback:function(){var e={name:"directions",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:x},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Направления")}},{width:120,label:"Дозировки",callback:function(){var e={name:"dosages",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:O},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Дозировки")}},{width:120,label:"Страны",callback:function(){var e={name:"countries",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:k},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Страны")}},{width:120,label:"Категории",callback:function(){var e={name:"categories",sorting:{id:"c_name",dir:"asc"},loadFunction:I.v,columns:j},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Категории")}},{width:120,label:"Области применения",callback:function(){var e={name:"appareas",loadFunction:I.v,sorting:{id:"c_name",dir:"asc"},columns:C},t=new F($$("sklad_main_ui").$scope.app,e);$$("sklad_main_ui").$scope.ui(t).show("Области применения")}}]};var U=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.cfg=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"popup",head:"sub-menu",loclalId:"_pop",padding:1,css:"pop-up-menu",relative:!0,body:{cols:[{localId:"__mform",rows:[]},{hidden:!0,localId:"__eform",rows:[]}]}}},t.prototype.isVisible=function(){return this.getRoot().isVisible()},t.prototype.show=function(e){return this.getRoot().show(e.$view)},t.prototype.hide=function(){return this.getRoot().hide()},t.prototype.init=function(){},t.prototype.ready=function(){var e=this,t=A[this.cfg.name],n=void 0;t.length>10?(t.slice(0,10).forEach((function(t){e.$$("__mform").addView(new l(e.app,t))})),n=t.slice(10),this.$$("__eform").show(),n.forEach((function(t){e.$$("__eform").addView(new l(e.app,t))}))):t.forEach((function(t){e.$$("__mform").addView(new l(e.app,t))}))},t}(o.c);function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var z=function(e){function t(){return M(this,t),L(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{view:"toolbar",localId:"sideMenu",borderless:!0,id:"_sideMenu",width:44,rows:[{height:20},{view:"button",hidden:!1,id:"__button__new_document",type:"htmlbutton",longPress:!1,width:40,height:40,template:function(){return e.getService("common").html_button_template("./library/img/new-document.svg","Новый документ","side_menu_button")},on:{onItemClick:function(e,t){this.$scope.new_docs.isVisible()?this.$scope.new_docs.hide():this.$scope.new_docs.show(this)}}},{view:"button",type:"htmlbutton",hidden:!1,id:"__button__references",longPress:!1,height:40,width:40,template:function(){return e.getService("common").html_button_template("./library/img/references.svg","Справочники","side_menu_button")},on:{onItemClick:function(){this.$scope.refs.isVisible()?this.$scope.refs.hide():this.$scope.refs.show(this)}}},{view:"button",type:"htmlbutton",hidden:!1,longPress:!0,id:"__button__balances",width:40,height:40,template:function(){return e.getService("common").html_button_template("./library/img/stocks.svg","Остатки","side_menu_button")},on:{onItemClick:function(){this.$scope.add_bar(this,c.default)}}},{view:"button",type:"htmlbutton",width:40,height:40,longPress:!1,id:"__button__arrivals",label:"",localId:"__arrivals",template:function(){return e.getService("common").html_button_template("./library/img/purchase_30x30.svg","Поступления","side_menu_button")},on:{onItemClick:function(e,t){this.$scope.add_bar(this,r.default)}}},{view:"button",type:"htmlbutton",width:40,height:40,longPress:!1,label:"",id:"__button__orders",localId:"__orders",template:function(){return e.getService("common").html_button_template("./library/img/orders.svg","Заказы","side_menu_button")},on:{onItemClick:function(e,t){this.$scope.add_bar(this,a.default)}}},{view:"button",type:"htmlbutton",width:40,height:40,longPress:!1,label:"",id:"__button__shipments",localId:"__shipments",template:function(){return e.getService("common").html_button_template("./library/img/shipment.svg","Отгрузки","side_menu_button")},on:{onItemClick:function(e,t){this.$scope.add_bar(this,s.default)}}},{view:"button",type:"htmlbutton",hidden:!0,width:40,height:40,id:"__button__movements",longPress:!1,label:"",template:function(){return e.getService("common").html_button_template("./library/img/movings.svg","Перемещения","side_menu_button")},on:{onItemClick:function(e,t){}}},{view:"button",type:"htmlbutton",hidden:!0,width:40,height:40,longPress:!1,id:"__button__transfers",label:"",template:function(){return e.getService("common").html_button_template("./library/img/transfers.svg","Передачи в розницу","side_menu_button")},on:{onItemClick:function(e,t){}}},{view:"button",type:"htmlbutton",hidden:!0,longPress:!1,id:"__button__analitics",height:40,width:40,template:function(){return e.getService("common").html_button_template("./library/img/statistics_30x30.svg","Аналитика","side_menu_button")},on:{onItemClick:function(){webix.message("Аналитика")}}},{view:"button",type:"htmlbutton",hidden:!0,id:"__button__reports",longPress:!0,width:40,height:40,template:function(){return e.getService("common").html_button_template("./library/img/report.svg","Отчеты","side_menu_button")},on:{onItemClick:function(){webix.message("Отчеты")}}},{view:"button",type:"htmlbutton",hidden:!0,id:"__button__options",longPress:!0,width:40,height:40,template:function(){return e.getService("common").html_button_template("./library/img/settings.svg","Настройки","side_menu_button")},on:{onItemClick:function(){webix.message("Настройки интерфейса и т.п.")}}},{view:"button",type:"htmlbutton",hidden:!0,id:"__button__users",longPress:!0,width:40,height:40,disabled:!(9!=e.config.role),template:function(){return e.getService("common").html_button_template("./library/img/users.svg","Пользователи","side_menu_button")},on:{onItemClick:function(){webix.message("Права доступа пользователей")}}},{}]}},t.prototype.add_bar=function(e,t){var n=t===r.default?R.screens.arrivals:t===s.default?R.screens.shipments:t===c.default?R.screens.balance:t===a.default?R.screens.orders:R.screens.info,o=n.id;if(this.screens[o])this.app.commonWidgets.centerbar.setValue(o);else{var i=n.name;if(!i)return!1;var l={id:o,value:i,width:n.width,close:!0},u={$scope:e.$scope,id:o,$subview:new t(this.app)};this.app.commonWidgets.centerbar.addBar(u,l)&&(this.screens[o]=!0)}},t.prototype.ready=function(){this.screens={_mView:!0}},t.prototype.init=function(){this.widget_name="sidebar",this.refs=this.ui(new U(this.app,{buttons:"refs_menu",name:"refs"})),this.new_docs=this.ui(new U(this.app,{buttons:"new_docs_menu",name:"docs"})),this.app.commonWidgets[this.widget_name]=this},t}(o.c);t.default=z},function(e,t,n){"use strict";n.r(t);var o=n(1);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(e){function t(){return i(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{template:"Новости, информация и т.п."}},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),s=n(0);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;return{view:"layout",id:"__bar__main_center",rows:[{view:"tabbar",tabMargin:8,localId:"__tabbar",borderless:!0,popupWidth:170,tabMinWidth:170,tabMoreWidth:70,animate:!1,multiview:!0,on:{onOptionRemove:function(t){$$(t).destructor(),delete e.commonWidgets.sidebar.screens[t]},onBeforeTabClose:function(t){if(Object.keys(e.commonWidgets.sidebar.screens).length<=1)return Object(s.message)("Для работы нужна хотя бы одна вкладка","error"),!1}},options:[{value:"Информация",id:"_mView",close:!0,width:130}]},{width:document.documentElement.clientWidth-46,view:"multiview",localId:"__multiview",animate:!1,keepViews:!0,cells:[{$subview:a,id:"_mView"}]}]}},t.prototype.setValue=function(e){this.$$("__tabbar").setValue(e)},t.prototype.addBar=function(e,t){var n=!0;try{this.$$("__multiview").addView(e),this.$$("__tabbar").addOption(t,!0)}catch(e){n=!1}return n},t.prototype.ready=function(){this.app.commonWidgets[this.widget_name]=this},t.prototype.init=function(){this.widget_name="centerbar"},t}(o.c);t.default=u},function(e,t,n){"use strict";var o=n(1);n(0);var i=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.widget=o,console.log("w",o),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app;return{view:"button",type:"htmlbutton",width:35,height:35,longPress:!1,label:"",localId:"__refresh",template:function(){return t.getService("common").html_button_template("./library/img/refresh_1.svg","Обновить")},on:{onItemClick:function(t,n){e.app.commonWidgets[e.widget].center_table.getData()}}}},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c);t.a=i},function(e,t,n){"use strict";var o=n(1),i=n(0),r=n(3),a=[{in:"row_num",headermenu:!1,width:50,template:function(e,t,n,o){return isNaN(e.row_num)?"":e.row_num+1}},{id:"n_id",hidden:!0,headermenu:!1,width:0},{id:"n_product",fillspace:1,header:[{text:"Товар"}],headermenu:!1,footer:{text:"всего:",colspan:3}},{id:"n_code",width:80,header:[{text:"Код"}],headermenu:!1},{id:"n_consignment",width:100,header:[{text:"Партия"}],headermenu:!1,editor:"text"},{id:"n_unit",width:160,hidden:!0,header:[{text:"Единица измерения"}],headermenu:!0},{id:"n_okei_code",width:160,header:[{text:"Код по ОКЕИ"}],hidden:!0,headermenu:!0,editor:"text"},{id:"n_type_package",width:140,header:[{text:"Вид упак."}],hidden:!0,headermenu:!0},{id:"n_amount_mass",width:120,header:[{text:"Кол-во(масса) в одном месте"}],hidden:!0,headermenu:!0},{id:"n_amount_b",width:90,header:[{text:"Мест, шт."}],headermenu:!0,hidden:!0},{id:"n_gross_weight",width:100,header:[{text:"Масса (брутто)"}],hidden:!0,headermenu:!0},{id:"n_amount",width:150,header:[{text:"Кол-во"}],headermenu:!1,editor:"text",footer:{content:"summColumn"}},{id:"n_price",width:80,header:[{text:"Цена, руб."}],headermenu:!1,editor:"price",format:webix.Number.formatNumber},{id:"n_novats_summ",width:160,header:[{text:"Сумма без НДС"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_vats_base",width:160,header:[{text:"НДС, ставка"}],headermenu:!1,editor:"select",options:["НДС 0%","НДС 10%","НДС 20%"]},{id:"n_vats_summ",width:160,header:[{text:"НДС, сумма"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_total_summ",width:160,header:[{text:"Сумма с НДС"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_prod_id",width:5,headermenu:!1,hidden:!0}],s=n(8),c=n(2),l=[{in:"row_num",headermenu:!1,width:50,template:function(e,t,n,o){return isNaN(e.row_num)?"":e.row_num+1}},{id:"n_id",hidden:!0,headermenu:!1,width:0},{id:"n_product",fillspace:1,header:[{text:"Товар"}],headermenu:!1,footer:{text:"всего:",colspan:3}},{id:"n_amount",width:80,header:[{text:"Кол-во"}],headermenu:!1},{id:"n_price",width:80,header:[{text:"Цена"}],headermenu:!1,format:webix.Number.formatNumber},{id:"n_total_summ",width:120,header:[{text:"Общая сумма"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_charge",width:80,header:[{text:"Наценка, %"}],headermenu:!1,editor:"text"},{id:"n_price_price",width:100,header:[{text:"Цена в прайс"}],headermenu:!1,editor:"price",format:webix.Number.formatNumber},{id:"n_total_price_summ",width:120,header:[{text:"Сумма в прайс"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_prod_id",width:5,headermenu:!1,hidden:!0}];var u=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.ids=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t={localId:"__header-form",borderless:!0,rows:[{view:"text",name:"n_id",localId:"__n_id",disabled:!0,width:0,hidden:!0},{height:c.emptyWidth},{rows:[{template:"Итого по документу",type:"section"},{cols:[{view:"text",label:"Наценка, %",value:"",format:"1111.00",labelPosition:"top",localId:"__charge",disabled:!1,name:"n_charge",labelWidth:100,on:{onChange:function(){e.recalcTable("all")}}},{view:"text",label:"Сумма документа",labelWidth:120,format:i.formatText,labelPosition:"top",disabled:!0,localId:"__sum"},{width:c.emptyWidth},{view:"text",label:"Сумма в прайс",labelWidth:120,format:i.formatText,labelPosition:"top",disabled:!0,localId:"__sum_price"},{width:c.emptyWidth},{view:"text",label:"Количество позиций",labelWidth:135,disabled:!0,labelPosition:"top",localId:"__pos"}]}]},{rows:[{view:"text",disabled:!0,value:"",label:"Поставщик",labelPosition:"top",name:"n_supplier",localId:"__supplier",labelWidth:0}]}]},n={view:"datatable",borderless:!0,name:"__shipments_document",clipboard:!0,localId:"__table",navigation:!0,select:"cell",resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,editaction:"custom",footer:!0,headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},data:{},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:l,on:{onItemClick:function(e){this.editCell(e.row,e.column)},onDataUpdate:function(e,t,n){t.n_charge&&n.n_charge!=t.n_charge?this.$scope.recalcTable("charge"):t.n_price_price&&n.n_price_price!=t.n_price_price&&this.$scope.recalcTable("price")}}};return{view:"cWindow",loclalId:"_popup",padding:4,point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}},width:.6*document.documentElement.clientWidth,height:.8*document.documentElement.clientHeight,body:{rows:[t,n,{borderless:!1,cols:[{},{view:"button",label:"Установить",width:136,localId:"__apply",on:{onItemClick:function(){var t=e.validate();(console.log("v",t),t)?Object(r.A)({table:e.$$("__table").serialize(),doc_id:e.$$("__n_id").getValue()})&&e.hide():Object(i.message)("Устанвите наценки, иначе товар не попадет в прайс","error",5)}}}]}]}}},t.prototype.validate=function(){var e=this.$$("__table"),t=!0;return e.mapCells(null,"n_price_price",null,1,(function(e){var n=+e;return console.log("v",n),isNaN(n)&&(t=!1),e})),t},t.prototype.getSum=function(e,t){var n=0;return e.mapCells(null,t,null,1,(function(e){var t=+e;return isNaN(t)||(n+=t),e})),n},t.prototype.show=function(e){var t=this;e&&this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().getHead().getChildViews()[1].hide();var n=Object(r.h)(this.ids);this.getRoot().show(),this.$$("__n_id").setValue(this.parent.doc.n_id);this.parent.$$("__table").serialize();this.$$("__table").clearAll(),n.data.forEach((function(e){var n={n_id:e.n_id,n_amount:e.n_amount,n_price:e.n_price,n_total_summ:e.n_total_summ,n_product:e.n_product};t.$$("__table").add(n)})),webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),this.$$("__table")),this.$$("__charge").focus()},t.prototype.recalcTable=function(e){var t=this.$$("__table");if(t.blockEvent(),"all"==e){var n=+this.$$("__charge").getValue();t.eachRow((function(e){var o=t.getItem(e);o.n_charge=n,o.n_price_price=o.n_price*(+o.n_charge+100)/100,o.n_total_price_summ=o.n_price_price*o.n_amount,o.n_total_summ=o.n_price*o.n_amount,t.updateItem(e,o)}))}else if("charge"==e){t.eachRow((function(e){var n=t.getItem(e),o=n.n_charge;null==o||isNaN(o)||(n.n_charge=(+o).toFixed(2),n.n_price_price=(n.n_price*(+o+100)/100).toFixed(0),n.n_total_price_summ=n.n_price_price*n.n_amount,n.n_total_summ=n.n_price*n.n_amount,t.updateItem(e,n))})),this.$$("__charge").blockEvent();var o=this.getSum(t,"n_price"),i=this.getSum(t,"n_price_price");this.$$("__charge").setValue(o<=i?charge.toFixed(2):""),this.$$("__charge").unblockEvent()}else if("price"==e){t.eachRow((function(e){var n=t.getItem(e),o=n.n_price_price/n.n_price*100-100;isNaN(o)||(n.n_charge=o.toFixed(2),n.n_total_price_summ=n.n_price_price*n.n_amount,n.n_total_summ=n.n_price*n.n_amount,t.updateItem(e,n))})),this.$$("__charge").blockEvent();var r=this.getSum(t,"n_price"),a=this.getSum(t,"n_price_price"),s=a/r*100-100;this.$$("__charge").setValue(r<=a?s.toFixed(2):""),this.$$("__charge").unblockEvent()}t.unblockEvent(),this.$$("__sum").setValue(this.getSum(t,"n_total_summ")),this.$$("__pos").setValue(this.getSum(t,"n_amount")),this.$$("__sum_price").setValue(this.getSum(t,"n_total_price_summ"))},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.ready=function(){},t.prototype.init=function(){},t}(o.c),d=n(6),h=n(9),p=[{id:"c_id",hidden:!0,headermenu:!1,width:5},{id:"c_code",width:150,header:[{text:Object(i.names)("c_code").value}],headermenu:!0,hidden:!1},{id:"c_name",fillspace:!0,sort:"server",header:[{text:Object(i.names)("c_name").value}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"c_namefull",width:250,sort:"server",header:[{text:Object(i.names)("c_namefull").value}],headermenu:!0,hidden:!0},{id:"c_vat",hidden:!0,headermenu:!1,width:5}];var f=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.s_sel=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,n=this;this.table_id=webix.uid();var o=new h.a(n.app,{columns:p,loadFunction:r.u,sorting:{id:"c_name",dir:"asc"},topParent:n,id:this.table_id,dblClick:function(e){if(e){var t=this.getItem(e);if(t={n_id:void 0,n_product:t.c_name,n_code:t.c_code,n_unit:"шт.",n_okei_code:"",n_type_package:"",n_amount_mass:"",n_amount_b:"",n_gross_weight:"",n_amount:1,n_price:"",n_novats_summ:"",n_vats_base:t.c_vat,n_vats_summ:"",n_total_summ:"",n_prod_id:t.c_id},n.s_sel){var o=JSON.parse(JSON.stringify(n.parent.getItem(n.s_sel)));console.log("old_item",o);var i=n.searchDuplicates(n.parent,t.n_prod_id);if(i){var r=n.parent.getItem(i);r.n_amount+=1,n.parent.updateItem(i,r),n.parent.remove(o.id)}else n.parent.updateItem(n.s_sel.row,t),o.n_prod_id||(delete o.id,n.parent.add(o));n.hide()}else if("datatable"===n.parent.config.view){var a=n.searchDuplicates(n.parent,t.n_prod_id);if(a){var s=n.parent.getItem(a);s.n_amount+=1,n.parent.updateItem(a,s)}else n.parent.$scope.add_new(t)}else console.log("new_item",t)}}});return(e={view:"cWindow",loclalId:"_popup",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}}}).width=.6*document.documentElement.clientWidth,e.height=.8*document.documentElement.clientHeight,e.body={rows:[{cols:[{view:"text",localId:"__search",label:"",name:"_search",labelWidth:0,width:450,hidden:!1,on:{onKeyPress:function(e,t){var n=this;clearTimeout(this.delay),this.delay=setTimeout((function(){n.$scope.getData()}),850)}}},{},{view:"button",label:"edit",width:50,tooltip:"Редактировать товар",localId:"__edit",hidden:!0,on:{onItemClick:function(){var e=$$(t.table_id).getSelectedItem();console.log("item",e),t.ui(new d.a(t.app,t,{c_id:e.c_id,c_name:e.c_name,id:e.id})).show()}}},{view:"button",label:"add",width:50,tooltip:"Добавить товар",localId:"__add",on:{onItemClick:function(){t.ui(new d.a(t.app,t,!1)).show()}}}]},o,{borderless:!1,cols:[{},{view:"button",label:"Закрыть",width:136,localId:"__apply",on:{onItemClick:function(){t.hide()}}}]}]},e},t.prototype.searchDuplicates=function(e,t){var n=void 0;return e.eachRow((function(o){var i=e.getItem(o);i.n_prod_id&&i.n_prod_id.toString()===t.toString()&&(n=o)})),n},t.prototype.getData=function(){var e=$$(this.table_id);e.clearAll(!0),e.loadNext(0,0,0,0,1).then((function(t){t&&(e.clearAll(!0),e.parse(t),e.showItemByIndex(0))}))},t.prototype.getFilter=function(){var e="";try{e=this.$$("__search").getValue()}catch(e){}return e},t.prototype.show=function(e){e&&this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.ready=function(){this.$$("__search").focus()},t.prototype.init=function(){},t}(o.c);var _=document.app.states,m=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this,n=this.app;return{view:"cWindow",localId:"__arrivalbody",width:.8*document.documentElement.clientWidth,height:.8*document.documentElement.clientHeight,padding:4,point:!1,relative:!1,modal:!1,move:!0,on:{onShow:function(){1==e.doc.n_state?e.$$("__hold").show():e.$$("__hold").hide(),1==e.doc.n_state?e.$$("__add").show():e.$$("__add").hide(),1==e.change?e.$$("__save").show():e.$$("__save").hide(),e.$$("__table").clearAll();var t=Object(r.g)(e.doc.n_id);t.data.push({n_product:"...добавить"}),e.$$("__table").parse(t)},onHide:function(){Object(r.d)(e.doc.n_id,!0),e.focus&&webix.UIManager.setFocus(e.focus)}},body:{rows:[{$subview:new s.a(n,t),localId:"__header"},{view:"datatable",borderless:!0,name:"__arrivals_document",clipboard:!0,localId:"__table",navigation:!0,select:"cell",resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},data:{},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:a,on:{onKeyPress:function(e,t){if("Delete"===t.key){var n=this.getSelectedId();this.remove(n)}},onAfterDelete:function(){t.setChange()},onLiveEdit:function(){},onDataUpdate:function(){t.setChange()},onItemDblClick:function(e){1==t.doc.n_state&&t.ui(new f(n,this,e)).show("Приходный документ. Подбор товара")}}},{borderless:!1,padding:3,cols:[{view:"button",width:136,localId:"__add",label:"подобрать товар",on:{onItemClick:function(){1==t.doc.n_state&&t.ui(new f(n,t.$$("__table"))).show("Приходный документ. Подбор товара")}}},{},{view:"button",label:"Сохранить",localId:"__save",width:136,on:{onItemClick:function(){var t=n.getService("common").saveDocument(e);return t?Object(i.message)(t,"error",3):e.setUnchange(),t}}},{view:"button",localId:"__hold",label:"Провести",width:136,on:{onItemClick:function(){if(!e.$$("__save").callEvent("onItemClick")){var t=n.getService("common").holdDocument("arrival",e.doc.n_id,e.doc.id);if(console.log("r_data",t),t.data)e.table&&(e.flag_new?Object(i.message)("ищем позицию и апдейтим ее"):e.table.updateItem(t.kwargs.filters.intable,t.data[0])),e.hide(),e.ui(new u(n,e,t.data1)).show("Установка наценок для прайса"),console.log("ss1");else Object(i.message)("Ошибка транзакции при проведении документа","error",3)}}}},{view:"button",width:136,localId:"__cancel",label:"Отменить",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.getConfirm=function(){webix.modalbox({title:"Документ был изменен",type:"confirm-warning",buttons:["Да","Нет","Отменить"],text:"сохранить изменения?",width:500}).then((function(e){switch(e){case"0":webix.message("Good!");break;case"1":webix.message("Why?..");break;case"2":webix.message("Come back later")}}))},t.prototype.show=function(e,t,n){if(this.flag_new=e.flag_new,this.change=!1,this.focus=t,this.table=n,this.doc=e,e){var o=_[e.n_state];return this.getRoot().getHead().getChildViews()[0].setValue('<span style="color: '+o.color+'">('+o.value+")</span> Приходный документ №"+(e.n_number||"")+" от "+webix.i18n.dateFormatStr(e.n_dt_invoice)+", "+(e.n_supplier||"")),this.getRoot().show(),webix.UIManager.setFocus(this.$$("__table"))}return!1},t.prototype.validateDocument=function(e,t){var n=!1;for(var o in t.header.n_base||(n="Укажите основание документа"),t.header.n_number||(n="Укажите номер документа"),t.header.n_supplier||(n="Укажите поставщика"),t.header.n_recipient||(n="Укажите получателя"),t.table.length<2&&(n="Добавьте товары"),t.table){var i=t.table[o];i.n_code&&((!i.n_amount||isNaN(i.n_amount)||+i.n_amount<0)&&(n="Неверное количество в строке "+(i.row_num?i.row_num+1:"")),(!i.n_price||i.n_price<=0)&&(n="Неверная цена в строке "+(i.row_num+1)),i.n_consignment||(n="Укажите партию в строке "+(i.row_num+1)))}return n},t.prototype.saveDocumentServer=function(e,t){var n=Object(r.x)(t,e.doc.id);return n.data&&n.data[0]?(this.table&&(this.flag_new?this.table.add(n.data[0],0):this.table.updateItem(n.kwargs.intable,n.data[0])),!1):"Ошибка записи на сервер"},t.prototype.getHeader=function(){return this.getRoot().getChildViews()[1].getChildViews()[0].$scope},t.prototype.setHeader=function(){return this.getHeader.setHeader()},t.prototype.hide=function(){return this.$$("__table").clearAll(),this.getRoot().hide()},t.prototype.add_new=function(e){var t=this.$$("__table").count();this.$$("__table").add(e,t-1),this.setChange(),this.recalcTable()},t.prototype.recalcTable=function(){var e=this.$$("__table");e.blockEvent(),e.eachRow((function(t){var n=e.getItem(t);n.n_code&&(n.n_novats_summ=n.n_price*n.n_amount,n.n_vats_summ=n.n_novats_summ*(+n.n_vats_base.replace("%","").replace("НДС ","")/100),n.n_total_summ=n.n_novats_summ+n.n_vats_summ,e.updateItem(t,n))})),e.unblockEvent(),this.getHeader().recalcHeader(e)},t.prototype.setUnchange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>'),this.recalcTable()},t.prototype.ready=function(){webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),this.$$("__table"))},t.prototype.init=function(){this.doc_type="Приходная накладная",this._block="recipient"},t}(o.c);t.a=m},function(e,t,n){"use strict";var o=n(1),i=n(0),r=n(3),a=[{in:"row_num",headermenu:!1,width:50,template:function(e,t,n,o){return isNaN(e.row_num)?"":e.row_num+1}},{id:"n_id",hidden:!0,headermenu:!1,width:0},{id:"n_product",fillspace:1,header:[{text:"Товар"}],headermenu:!1,footer:{text:"всего:",colspan:3}},{id:"n_code",width:80,header:[{text:"Код"}],headermenu:!1},{id:"n_unit",width:160,hidden:!0,header:[{text:"Единица измерения"}],headermenu:!0},{id:"n_okei_code",width:160,header:[{text:"Код по ОКЕИ"}],hidden:!0,headermenu:!0,editor:"text"},{id:"n_type_package",width:140,header:[{text:"Вид упак."}],hidden:!0,headermenu:!0},{id:"n_amount_mass",width:120,header:[{text:"Кол-во(масса) в одном месте"}],hidden:!0,headermenu:!0},{id:"n_amount_b",width:90,header:[{text:"Мест, шт."}],headermenu:!0,hidden:!0},{id:"n_gross_weight",width:100,header:[{text:"Масса (брутто)"}],hidden:!0,headermenu:!0},{id:"n_price",width:80,header:[{text:"Цена, руб."}],headermenu:!1,format:webix.Number.formatNumber},{id:"n_vat",width:100,header:[{text:"НДС"}],headermenu:!1,format:webix.Number.formatNumber},{id:"n_amount",width:80,header:[{text:"Кол-во"}],headermenu:!1,editor:"text",footer:{content:"summColumn"}},{id:"n_stock",width:80,header:[{text:"В наличии"}],headermenu:!1},{id:"n_charge",width:80,header:[{text:"Наценка, %"}],headermenu:!1,editor:"text"},{id:"n_ship_price",width:100,header:[{text:"Отп.цена, руб."}],headermenu:!1,editor:"price",format:webix.Number.formatNumber},{id:"n_novats_summ",width:100,header:[{text:"Сумма без НДС"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_vats_summ",width:100,header:[{text:"НДС, сумма"}],hidden:!1,headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_total_summ",width:120,header:[{text:"Сумма с НДС"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_prod_id",width:5,headermenu:!1,hidden:!0},{id:"n_balance_id",width:5,headermenu:!1,hidden:!0}],s=[{id:"n_id",hidden:!0,headermenu:!1,width:5},{id:"n_code",width:80,header:[{text:"Код товара"}],headermenu:!0,hidden:!1},{id:"n_product",fillspace:!0,sort:"server",header:[{text:"Наименование"}],headermenu:!1,footer:{content:"totalTableLong"},filter_type:"text"},{id:"n_quantity",sort:"server",header:[{text:"Остаток"}],headermenu:!0,hidden:!1},{id:"n_price",sort:"server",header:[{text:"Цена"}],headermenu:!0,hidden:!1,format:webix.Number.formatNumber},{id:"n_vat",hidden:!0,headermenu:!0,header:[{text:"НДС"}],width:50,format:webix.Number.formatNumber}],c=n(6);var l=function(e){function t(n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return r.parent=o,r.s_sel=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this;return(e={view:"cWindow",loclalId:"_popup",width:420,padding:4,point:!1,toFront:!0,relative:!0,modal:!0,css:"menu_filters",escHide:!0,on:{onShow:function(){},onHide:function(){this.destructor()}}}).width=.6*document.documentElement.clientWidth,e.height=.8*document.documentElement.clientHeight,e.body={rows:[{cols:[{view:"text",localId:"__search",label:"",name:"_search",labelWidth:0,width:450,hidden:!1,on:{onKeyPress:function(e,t){var n=this;clearTimeout(this.delay),this.delay=setTimeout((function(){n.$scope.getData()}),850)}}},{},{view:"button",label:"edit",width:50,tooltip:"Редактировать товар",localId:"__edit",hidden:!0,on:{onItemClick:function(){var e=t.$$("__table").getSelectedItem();console.log("item",e),t.ui(new c.a(t.app,t,{c_id:e.c_id,c_name:e.c_name,id:e.id})).show()}}},{view:"button",label:"add",width:50,tooltip:"Добавить товар",localId:"__add",hidden:!0,on:{onItemClick:function(){t.ui(new c.a(t.app,t,!1)).show()}}}]},{view:"datatable",borderless:!0,clipboard:!0,localId:"__table",navigation:"row",select:"row",datafetch:30,datathrottle:10,loadahead:40,resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,url:function(e){return Object(r.F)(e,this)},headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:s,sorting:{id:"n_product",dir:"asc"},onClick:{},onContext:{},on:{onAfterSelect:function(){this.getSelectedId()},onAfterLoad:function(){this.markSorting(this.config.sorting.id,this.config.sorting.dir)},onKeyPress:function(e,t){if(13===e){var n=this.getSelectedId();this.callEvent("onItemDblClick",[n])}},onItemDblClick:function(e){if(e){var t=this.getItem(e);if(t={n_id:void 0,n_product:t.n_product,n_code:t.n_code,n_unit:"",n_okei_code:"",n_type_package:"",n_amount_mass:"",n_amount_b:"",n_gross_weight:"",n_stock:t.n_quantity,n_amount:1,n_charge:"",n_price:t.n_price,n_vat:t.n_vat,n_novats_summ:"",n_vats_summ:"",n_total_summ:"",n_prod_id:t.n_id},this.$scope.s_sel){var n=JSON.parse(JSON.stringify(this.$scope.parent.getItem(this.$scope.s_sel))),o=this.$scope.searchDuplicates(this.$scope.parent,t.n_prod_id);if(o){var i=this.$scope.parent.getItem(o);i.n_amount+=1,this.$scope.parent.updateItem(o,i),this.$scope.parent.remove(n.id)}else this.$scope.parent.updateItem(this.$scope.s_sel.row,t),n.n_prod_id||(delete n.id,this.$scope.parent.add(n));this.$scope.hide()}else if(console.log("5"),"datatable"===this.$scope.parent.config.view){var r=this.$scope.searchDuplicates(this.$scope.parent,t.n_prod_id);if(r){var a=this.$scope.parent.getItem(r);a.n_amount+=1,this.$scope.parent.updateItem(r,a)}else this.$scope.parent.$scope.add_new(t)}else console.log("new_item",t)}}}},{borderless:!1,cols:[{},{view:"button",label:"Закрыть",width:136,localId:"__apply",on:{onItemClick:function(){t.hide()}}}]}]},e},t.prototype.searchDuplicates=function(e,t){var n=void 0;return e.eachRow((function(o){var i=e.getItem(o);i.n_prod_id&&i.n_prod_id.toString()===t.toString()&&(n=o)})),n},t.prototype.getData=function(){var e=this;this.$$("__table").loadNext(0,0,0,0,1).then((function(t){t&&(e.$$("__table").clearAll(!0),e.$$("__table").parse(t),e.$$("__table").showItemByIndex(0))}))},t.prototype.getFilter=function(){var e="";try{e=this.$$("__search").getValue()}catch(e){}return e},t.prototype.show=function(e){e&&this.getRoot().getHead().getChildViews()[0].setValue(e),this.getRoot().show()},t.prototype.hide=function(){var e=this;setTimeout((function(){return e.getRoot().hide()}),10)},t.prototype.ready=function(){this.$$("__search").focus()},t.prototype.init=function(){},t}(o.c),u=n(8);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=document.app.states,f=function(e){function t(){return d(this,t),h(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,n=this,o=this.app;return{view:"cWindow",localId:"__shipmentbody",width:.8*document.documentElement.clientWidth,height:.8*document.documentElement.clientHeight,padding:4,point:!1,relative:!1,modal:!1,move:!0,on:{onShow:function(){1==t.doc.n_state?t.$$("__hold").show():t.$$("__hold").hide(),1==t.doc.n_state?t.$$("__add").show():t.$$("__add").hide(),1==t.change?t.$$("__save").show():t.$$("__save").hide();var e=void 0;e=t.base?Object(r.m)(t.base):Object(r.r)(t.doc.n_id),t.$$("__table").clearAll(),e.data.push({n_product:"...добавить"}),t.$$("__table").parse(e),setTimeout((function(){t.getHeader().recalcHeader&&t.getHeader().recalcHeader(t.$$("__table"))}),100);var n=t.$$("__table");n.eachRow((function(e){n.getItem(e).warning&&n.addCss(e,"warning")}))},onHide:function(){Object(r.d)(t.doc.n_id,!0),t.focus&&webix.UIManager.setFocus(t.focus)}},body:{localId:"__body",rows:[{cols:[{view:"text",width:250,label:"Наценка на документ, %",value:"",localId:"__charge",name:"n_charge",labelWidth:150,on:{onChange:function(){}}},{}]},{$subview:new u.a(o,n),localId:"__header"},{view:"datatable",borderless:!0,name:"__shipments_document",clipboard:!0,localId:"__table",navigation:!0,select:"cell",resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!0,footer:!0,headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},data:{},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:a,on:(e={onKeyPress:function(e,t){if("Delete"===t.key){var n=this.getSelectedId();this.remove(n)}},onAfterDelete:function(){n.setChange()},onLiveEdit:function(){},onAfterLoad:function(){this.count()>1&&n.recalcTable()},onAfterAdd:function(){}},e.onAfterDelete=function(){},e.onDataUpdate=function(){n.setChange()},e.onItemDblClick=function(e){1==n.doc.n_state&&n.ui(new l(o,this,e)).show("Приходный документ. Подбор товара")},e)},{borderless:!1,padding:3,cols:[{view:"button",width:136,localId:"__add",label:"подобрать товар",on:{onItemClick:function(){1==n.doc.n_state&&n.ui(new l(o,n.$$("__table"))).show("Приходный документ. Подбор товара")}}},{},{view:"button",label:"Сохранить",localId:"__save",width:136,on:{onItemClick:function(){var e=o.getService("common").saveDocument(t);return e?Object(i.message)(e,"error",3):t.setUnChange(),e}}},{view:"button",localId:"__hold",label:"Провести",width:136,on:{onItemClick:function(){if(!t.$$("__save").callEvent("onItemClick")){var e=o.getService("common").holdDocument("shipment",t.doc.n_id,t.doc.id);e.data?(t.table&&(t.flag_new?Object(i.message)("ищем позицию и апдейтим ее"):t.table.updateItem(e.kwargs.filters.intable,e.data[0])),t.hide()):Object(i.message)("Ошибка проведения транзакции","error",3)}}}},{view:"button",width:136,localId:"__cancel",label:"Отменить",on:{onItemClick:function(){t.hide()}}}]}]}}},t.prototype.getConfirm=function(){webix.modalbox({title:"Документ был изменен",type:"confirm-warning",buttons:["Да","Нет","Отменить"],text:"сохранить изменения?",width:500}).then((function(e){switch(e){case"0":webix.message("Good!");break;case"1":webix.message("Why?..");break;case"2":webix.message("Come back later")}}))},t.prototype.show=function(e,t,n){if(this.flag_new=e.flag_new,this.base=e.order_id,this.change=!1,this.focus=t,this.table=n,this.doc=e,e){var o=p[e.n_state];this.getRoot().getHead().getChildViews()[0].setValue('<span style="color: '+o.color+'">('+o.value+")</span> Отгрузка №"+(e.n_number||"")+" от "+webix.i18n.dateFormatStr(e.n_dt_invoice)+", "+(e.n_supplier||"")),this.getRoot().show(),webix.UIManager.setFocus(this.$$("__table"))}2==this.doc.n_state&&(this.$$("__table").disable(),this.$$("__charge").disable())},t.prototype.validateDocument=function(e,t){var n=!1;for(var o in t.header.n_base||(n="Укажите основание документа"),t.header.n_number||(n="Укажите номер документа"),t.header.n_supplier||(n="Укажите поставщика"),t.header.n_recipient||(n="Укажите получателя"),t.table.length<2&&(n="Добавьте товары"),t.table){var i=t.table[o];i.n_code&&((!i.n_amount||isNaN(i.n_amount)||+i.n_amount<0)&&(n="Неверное количство в строке "+(i.row_num?i.row_num+1:"")),i.n_stock<i.n_amount&&(n="Количество на складе меньше чем в заказе в строке "+(i.row_num+1)),(!i.n_price||i.n_price<=0)&&(n="Неверная цена в строке "+(i.row_num+1)))}return n},t.prototype.saveDocumentServer=function(e,t){var n=Object(r.z)(t,e.doc.id);return n.data&&n.data[0]?(this.table&&(this.flag_new?this.table.add(n.data[0],0):this.table.updateItem(n.kwargs.intable,n.data[0])),!1):"Ошибка записи на сервер"},t.prototype.getHeader=function(){return this.getRoot().getChildViews()[1].getChildViews()[1].$scope},t.prototype.setHeader=function(){return this.getHeader.setHeader()},t.prototype.hide=function(){return this.$$("__table").clearAll(),this.getRoot().hide()},t.prototype.add_new=function(e){var t=this.$$("__table").count();this.$$("__table").add(e,t-1),this.setChange(),this.recalcTable()},t.prototype.recalcTable=function(){var e=this.$$("__table");function t(t){var n=0;return e.mapCells(null,t,null,1,(function(e){var t=+e;return isNaN(t)||(n+=t),e})),n}e.blockEvent(),e.eachRow((function(t){var n=e.getItem(t);n.n_stock<n.n_amount?e.addCss(t,"warning"):e.removeCss(t,"warning"),n.n_code&&(n.n_ship_price=n.n_price*(+n.n_charge+100)/100,n.n_novats_summ=n.n_ship_price*n.n_amount,n.n_vats_summ=n.n_amount*(n.n_vat*(+n.n_charge+100)/100),n.n_total_summ=n.n_novats_summ+n.n_vats_summ,e.updateItem(t,n))}));var n=t("n_price"),o=t("n_ship_price")/n*100-100;this.$$("__charge").setValue(o.toFixed(2)),e.unblockEvent(),this.getHeader().recalcHeader&&this.getHeader().recalcHeader(e)},t.prototype.setUnChange=function(){this.change=!1;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").hide(),e.setValue(e.getValue().replace('<span class="changed">  изменен</span>',""))},t.prototype.setChange=function(){this.change=!0;var e=this.getRoot().getHead().getChildViews()[0];this.$$("__save").show(),0===e.$view.querySelectorAll('[class="changed"]').length&&e.setValue(e.getValue()+'<span class="changed">  изменен</span>'),this.recalcTable()},t.prototype.ready=function(){webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),this.$$("__table"))},t.prototype.init=function(){this.doc_type="Отгрузка",this._block="supplier"},t}(o.c);t.a=f},function(e,t,n){"use strict";var o=n(1),i=(n(0),n(3)),r=[{in:"row_num",hidden:!0,headermenu:!1,width:50,template:function(e,t,n,o){return isNaN(e.row_num)?"":e.row_num+1}},{id:"n_id",hidden:!0,headermenu:!1,width:0},{id:"n_doc_id",hidden:!0,headermenu:!1,width:0},{id:"n_product",fillspace:1,header:[{text:"Товар"}],headermenu:!1,footer:{text:"всего:",colspan:3}},{id:"n_product_order",width:250,header:[{text:"Товар в заказе"}],headermenu:!0,hidden:!0},{id:"n_man",width:200,header:[{text:"Производитель"}],headermenu:!0},{id:"n_code",width:80,header:[{text:"Код"}],headermenu:!1},{id:"n_amount",width:150,header:[{text:"Кол-во в заказе"}],headermenu:!1,editor:"text",footer:{content:"summColumn"}},{id:"n_balance_qty",width:150,header:[{text:"Кол-во на складе"}],headermenu:!1,editor:"text",footer:{content:"summColumn"}},{id:"n_price",width:80,header:[{text:"Цена, руб."}],headermenu:!1,editor:"price",format:webix.Number.formatNumber},{id:"n_total_summ",width:160,header:[{text:"Сумма с НДС"}],headermenu:!1,footer:{content:"totalColumn"},format:webix.Number.formatNumber},{id:"n_comment",width:250,header:[{text:"Комментарий к позиции"}],headermenu:!0},{id:"n_prod_id",hidden:!0,headermenu:!1,width:0},{id:"n_balance_id",hidden:!0,headermenu:!1,width:0}],a=n(8);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=document.app.states,u=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this;this.app;return{view:"cWindow",localId:"__orderbody",width:.8*document.documentElement.clientWidth,height:.8*document.documentElement.clientHeight,padding:4,point:!1,relative:!1,modal:!1,move:!0,on:{onShow:function(){e.$$("__table").clearAll();var t=Object(i.l)(e.doc.n_id);e.$$("__table").parse(t)},onHide:function(){Object(i.d)(e.doc.n_id,!0),e.focus&&webix.UIManager.setFocus(e.focus)}},body:{rows:[{$subview:new a.a(t.app,t,!0),localId:"__header"},{view:"datatable",borderless:!0,name:"__orders_document",clipboard:!0,localId:"__table",navigation:!0,select:"cell",resizeColumn:!0,fixedRowHeight:!1,rowLineHeight:28,rowHeight:28,editable:!1,footer:!0,headermenu:{autowidth:!0,scroll:!0,autoheight:!1,spans:!0,yCount:4},data:{},css:"webix_header_border center_dt",scroll:"xy",tooltip:!0,columns:r,on:{onKeyPress:function(e,t){if("Delete"===t.key){var n=this.getSelectedId();this.remove(n)}},onAfterDelete:function(){t.setChange()},onLiveEdit:function(){},onDataUpdate:function(){t.setChange()},onItemDblClick:function(e){}}},{borderless:!1,padding:3,cols:[{view:"button",width:136,localId:"__add",label:"подобрать товар",hidden:!0,on:{onItemClick:function(){}}},{},{view:"button",label:"Сохранить",localId:"__save",hidden:!0,width:136,on:{onItemClick:function(){}}},{view:"button",localId:"__hold",label:"Провести",width:136,hidden:!0,on:{onItemClick:function(){}}},{view:"button",width:136,localId:"__cancel",label:"Отменить",on:{onItemClick:function(){e.hide()}}}]}]}}},t.prototype.getConfirm=function(){webix.modalbox({title:"Документ был изменен",type:"confirm-warning",buttons:["Да","Нет","Отменить"],text:"сохранить изменения?",width:500}).then((function(e){switch(e){case"0":webix.message("Good!");break;case"1":webix.message("Why?..");break;case"2":webix.message("Come back later")}}))},t.prototype.show=function(e,t,n){if(this.flag_new=e.flag_new,this.change=!1,this.focus=t,this.table=n,this.doc=e,e){var o=l[e.n_state];return this.getRoot().getHead().getChildViews()[0].setValue('<span style="color: '+o.color+'">('+o.value+")</span> Заказ покупателя от "+webix.i18n.dateFormatStr(e.n_dt_invoice)+", "+(e.n_recipient||"")),this.getRoot().show(),webix.UIManager.setFocus(this.$$("__table"))}return!1},t.prototype.validateDocument=function(e,t){var n=!1;for(var o in t.header.n_base||(n="Укажите основание документа"),t.header.n_number||(n="Укажите номер документа"),t.header.n_supplier||(n="Укажите поставщика"),t.header.n_recipient||(n="Укажите получателя"),t.table.length<2&&(n="Добавьте товары"),t.table){var i=t.table[o];i.n_code&&((!i.n_amount||isNaN(i.n_amount)||+i.n_amount<0)&&(n="Неверное количство в строке "+(i.row_num?i.row_num+1:"")),(!i.n_price||i.n_price<=0)&&(n="Неверная цена в строке "+(i.row_num+1)))}return n},t.prototype.saveDocumentServer=function(e,t){var n=Object(i.y)(t,e.doc.id);return n.data&&n.data[0]?(this.table&&(this.flag_new?this.table.add(n.data[0],0):this.table.updateItem(n.kwargs.intable,n.data[0])),!1):"Ошибка записи на сервер"},t.prototype.getHeader=function(){return this.getRoot().getChildViews()[1].getChildViews()[0].$scope},t.prototype.setHeader=function(){return this.getHeader.setHeader()},t.prototype.hide=function(){return this.$$("__table").clearAll(),this.getRoot().hide()},t.prototype.add_new=function(e){var t=this.$$("__table").count();this.$$("__table").add(e,t-1),this.setChange(),this.recalcTable()},t.prototype.recalcTable=function(){var e=this.$$("__table");e.blockEvent(),e.eachRow((function(t){var n=e.getItem(t);n.n_code&&(n.n_novats_summ=n.n_price*n.n_amount,n.n_vats_summ=n.n_novats_summ*(+n.n_vats_base.replace("%","").replace("НДС ","")/100),n.n_total_summ=n.n_novats_summ+n.n_vats_summ,e.updateItem(t,n))})),e.unblockEvent(),this.getHeader().recalcHeader(e)},t.prototype.setUnchange=function(){},t.prototype.setChange=function(){},t.prototype.ready=function(){webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),this.$$("__table"))},t.prototype.init=function(){this.doc_type="Заказ покупателя"},t}(o.c);t.a=u},function(e,t){webix.i18n.locales["ru-RU"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d.%m.%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} руб.",priceSettings:null,calendar:{monthFull:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShort:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFull:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],hours:"Часы",minutes:"Минуты",done:"Гoтовo",clear:"Очистить",today:"Сегодня"},controls:{select:"Выбрать",invalidMessage:"Неправильное значение"},dataExport:{page:"Страница",of:"из"},PDFviewer:{of:"из",automaticZoom:"Автоматический зум",actualSize:"Настоящий размер",pageFit:"Размер страницы",pageWidth:"Ширина страницы",pageHeight:"Высота страницы"},aria:{calendar:"Календарь",increaseValue:"Увеличить значение",decreaseValue:"Уменьшить значение",navMonth:["Предыдущий месяц","Следующий месяц"],navYear:["Предыдущий год","Следующий год"],navDecade:["Предыдущие десять лет","Следующие десять лет"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Часы: %H",minuteFormat:"Минуты: %i",removeItem:"Удалить элемент",pages:["Первая страница","Предыдущая страница","Следующая страница","Последняя страница"],page:"Страница",headermenu:"Меню шапки таблицы",openGroup:"Развернуть группу столбцов",closeGroup:"Свернуть группу столбцов",closeTab:"Закрыть вкладку",showTabs:"Показать больше вкладок",resetTreeMap:"Вернуться к первоначальному представлению",navTreeMap:"Перейти на уровень выше",nextTab:"Следующая вкладка",prevTab:"Предыдущая вкладка",multitextSection:"Добавить элемент",multitextextraSection:"Удалить элемент",showChart:"Показать чарт",hideChart:"Спрятать чарт",resizeChart:"Изменить размер чарта"},richtext:{underline:"Подчеркивание",bold:"Жирный",italic:"Курсив"},combo:{select:"Выбрать",selectAll:"Выбрать все",unselectAll:"Невыбрать все"}}},function(e,t,n){"use strict";var o=n(1);n(0);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}!function(e){function t(){return i(this,t),r(this,e.apply(this,arguments))}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(t,e),t.prototype.config=function(){return{view:"text",label:"",labelWidth:0,value:"",width:450,placeholder:"Поиск по составу",on:{onItemClick:function(){console.log("clickk")}}}},t.prototype.ready=function(){this.app.commonWidgets.search_bar=this},t.prototype.init=function(){}}(o.c)},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(0),r=n(17),a=n.n(r),s=n(3);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=e.app,n={view:"form",localId:"auth_box",label:"Аутентификация",elements:[{view:"text",label:"Пользователь",name:"user",labelWidth:120,width:400,localId:"_user"},{view:"text",type:"password",label:"Пароль",name:"pass",labelWidth:120,width:400},{cols:[{},{},{view:"button",label:"OK",hotkey:"enter",tooltip:"Войти",click:function(){e.validate_user(e.$$("auth_box").getValues())?this.$scope.show("/start"):(Object(i.message)("не авторизованно","error"),Object(i.deleteCookie)(t.config.sklad_cook))}}]}]};return{view:"layout",rows:[{height:document.documentElement.clientHeight/4},{cols:[{},n,{}]},{}]}},t.prototype.ready=function(){this.$$("_user").focus()},t.prototype.init=function(){var e=this.app;Object(i.getCookie)(e.config.sklad_cook)&&this.show("/start")},t.prototype.validate_user=function(e){var t=this.app,n=!1;e.pass=a()(e.pass);var o=Object(s.k)(e.user,e.pass);if(o&&o.data&&!o.reason){var r=o.data[0];n=!0;Object(i.setCookie)(t.config.sklad_cook,[r.n_sklad_name,r.n_hash].join(""),{path:"/",expires:0})}return n},t}(o.c);t.default=u},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(16),r=n(15),a=n(19),s=n(18),c=n(0),l=n(3);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){return u(this,t),d(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{type:"line",id:"sklad_main_ui",rows:[{$subview:i.default},{height:2},{cols:[{$subview:s.default},{$subview:a.default}]},{$subview:r.default}]}},t.prototype.getError=function(e){var t=this;1===e?webix.alert({type:"alert-error",title:"Ошибка регистрации",text:"Пользователь не зарегистрирован в системе. Обратитесь к администратору",width:500}).then((function(n){t.getError(e)})):2===e&&webix.alert({type:"alert-error",title:"Ошибка входа",buttons:["OK"],text:"Авторизуйтесь в складе и обновите страницу",width:300}).then((function(n){t.getError(e)}))},t.prototype.init=function(){var e=Object(c.getCookie)(this.app.config.sklad_cook);if(localStorage.setItem("opened",""),e.length>32){var t=decodeURI(e.slice(0,-32)),n=Object(l.i)(t);n.data?(this.app.config.user=n.data[0].n_name,this.app.config.user_id=n.data[0].n_id,this.app.config.home_org_id=n.data[0].n_home_id,this.app.config.home_org=n.data[0].n_home_name):this.getError(1)}else this.getError(2)},t.prototype.ready=function(){this.app.commonWidgets.header.setUser(),this.app.commonWidgets.header.setOrg()},t}(o.c);t.default=h},function(e,t){},function(e,t,n){"use strict";n.r(t);n(30),n(2);var o=n(0),i=n(1),r=(n(24),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e});var a=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a={production:!0,id:"sklad71App",name:"sklad71",version:"2020.212.1127",start:"/login",home_org_id:"",home_org:"",user:"",fullname:"",role:0,eventS:void 0,router:i.a,x_api:"x_login",debug:!0,searchDelay:1e3,popDelay:800,roles:[],sklad_cook:"sk_new-app",user_id:"",restricted:{},restricted_menu:{}},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r({},a,n)));document.rpc_url="https://online365.pro/RPC/",s.attachEvent("app:error:resolve",(function(e,t){window.console.error(t)}));var c=s;return c.use(o.common),document.app=c,c.commonWidgets={arrivals:{},shipments:{},orders:{}},webix.attachEvent("onBeforeAjax",(function(e,t,n,o,i,r,a){i["x-api-key"]=c.config.x_api})),window.onerror=function(e,t,n,o,i){return webix.message({text:"Возникла ошибка - мы работаем над ее исправлением. Текст в консоли",type:"error",width:"800px",delay:"5"}),window.console.log("message:",e),window.console.log("source:",t),window.console.log("err:",i),!0},c.attachEvent("app:error:resolve",(function(e,t){window.console.error(t)})),Object(o.getRefs)(c),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(i.b);t.default=a,Object(o.extendWebix)(),webix.i18n.setLocale("ru-RU"),webix.ready((function(){return(new a).render()})),webix.protoUI({name:"sklad71",app:a},webix.ui.jetapp)},function(e,t,n){},function(e,t,n){var o={"./arrivals":11,"./arrivals.js":11,"./balance":14,"./balance.js":14,"./center":19,"./center.js":19,"./common":0,"./common.js":0,"./footer":15,"./footer.js":15,"./header":16,"./header.js":16,"./login":26,"./login.js":26,"./md5":17,"./md5.js":17,"./orders":13,"./orders.js":13,"./shipments":12,"./shipments.js":12,"./sidebuttons-bar":18,"./sidebuttons-bar.js":18,"./start":27,"./start.js":27,"./variables":2,"./variables.js":2};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=r,e.exports=i,i.id=31},function(e,t,n){var o={"./en":28,"./en.js":28,"./ru":24,"./ru.js":24};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=r,e.exports=i,i.id=32}]);